<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>尚硅谷_ShardingSphere5 | 初冬十月の笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <script>
		       var _hmt = _hmt || [];
		       (function() {
		         var hm = document.createElement("script");
		         hm.src = "https://hm.baidu.com/hm.js?ea067d5ff639c55d3843c3f224a1c187";
		         var s = document.getElementsByTagName("script")[0]; 
		         s.parentNode.insertBefore(hm, s);
		       })();
		         </script>
    <meta name="description" content="初冬十月の笔记努力加载中~~">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="keywords" content="初冬十月,maiaimei,maiamy,maiam">
    
    <link rel="preload" href="/assets/css/0.styles.486d4e19.css" as="style"><link rel="preload" href="/assets/js/app.b0706364.js" as="script"><link rel="preload" href="/assets/js/4.e0c2274c.js" as="script"><link rel="preload" href="/assets/js/1.f767751f.js" as="script"><link rel="preload" href="/assets/js/5.0d1dda84.js" as="script"><link rel="prefetch" href="/assets/js/10.9dd8fd2f.js"><link rel="prefetch" href="/assets/js/11.7fc95448.js"><link rel="prefetch" href="/assets/js/12.a49836c6.js"><link rel="prefetch" href="/assets/js/13.a263fffd.js"><link rel="prefetch" href="/assets/js/14.0dcf35f6.js"><link rel="prefetch" href="/assets/js/15.17fa6b02.js"><link rel="prefetch" href="/assets/js/16.16492d28.js"><link rel="prefetch" href="/assets/js/17.99ffd521.js"><link rel="prefetch" href="/assets/js/18.a202dd51.js"><link rel="prefetch" href="/assets/js/19.4e2716f9.js"><link rel="prefetch" href="/assets/js/20.fbf29696.js"><link rel="prefetch" href="/assets/js/21.b408955b.js"><link rel="prefetch" href="/assets/js/22.c9df7ae9.js"><link rel="prefetch" href="/assets/js/23.5742d03d.js"><link rel="prefetch" href="/assets/js/24.9dba730e.js"><link rel="prefetch" href="/assets/js/25.cf5855a2.js"><link rel="prefetch" href="/assets/js/26.b23c5543.js"><link rel="prefetch" href="/assets/js/27.ba7535a9.js"><link rel="prefetch" href="/assets/js/28.27f64c0e.js"><link rel="prefetch" href="/assets/js/29.76a827e0.js"><link rel="prefetch" href="/assets/js/3.fdc30d48.js"><link rel="prefetch" href="/assets/js/30.6eb9849a.js"><link rel="prefetch" href="/assets/js/31.18971092.js"><link rel="prefetch" href="/assets/js/32.f5bb4a7b.js"><link rel="prefetch" href="/assets/js/33.0a6952e6.js"><link rel="prefetch" href="/assets/js/34.f64dc6b3.js"><link rel="prefetch" href="/assets/js/35.1b2b540f.js"><link rel="prefetch" href="/assets/js/36.4a32cb36.js"><link rel="prefetch" href="/assets/js/37.6851c133.js"><link rel="prefetch" href="/assets/js/38.f11d93ee.js"><link rel="prefetch" href="/assets/js/39.10c2d691.js"><link rel="prefetch" href="/assets/js/40.8de7fbba.js"><link rel="prefetch" href="/assets/js/41.4e9ff390.js"><link rel="prefetch" href="/assets/js/42.81b3163d.js"><link rel="prefetch" href="/assets/js/43.3b89cb5d.js"><link rel="prefetch" href="/assets/js/44.a1f4c894.js"><link rel="prefetch" href="/assets/js/45.287d0813.js"><link rel="prefetch" href="/assets/js/46.9ddd1a72.js"><link rel="prefetch" href="/assets/js/47.d1981800.js"><link rel="prefetch" href="/assets/js/48.d1413ef9.js"><link rel="prefetch" href="/assets/js/49.6ef1fab7.js"><link rel="prefetch" href="/assets/js/50.a7024ce5.js"><link rel="prefetch" href="/assets/js/51.3adcbc8c.js"><link rel="prefetch" href="/assets/js/52.f34210d2.js"><link rel="prefetch" href="/assets/js/53.eeece0cf.js"><link rel="prefetch" href="/assets/js/54.6da24c0d.js"><link rel="prefetch" href="/assets/js/55.71a33285.js"><link rel="prefetch" href="/assets/js/56.d3c16c8c.js"><link rel="prefetch" href="/assets/js/6.7c18793b.js"><link rel="prefetch" href="/assets/js/7.caf38534.js"><link rel="prefetch" href="/assets/js/8.ed6aea95.js"><link rel="prefetch" href="/assets/js/9.abdbf1b2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.486d4e19.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>初冬十月の笔记</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>初冬十月の笔记努力加载中~~</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>maiaimei</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="初冬十月の笔记" class="logo"> <span class="site-name">初冬十月の笔记</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/avatar.jpg" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    maiaimei
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>41</h3> <h6 data-v-828910c6>文章</h6></div> <div data-v-828910c6><h3 data-v-828910c6>34</h3> <h6 data-v-828910c6>标签</h6></div></div> <ul class="social-links" data-v-828910c6><li class="social-item" data-v-828910c6><i class="iconfont reco-github" style="color:#abbd81;" data-v-828910c6></i></li><li class="social-item" data-v-828910c6><i class="iconfont reco-mayun" style="color:#f8b26a;" data-v-828910c6></i></li></ul> <hr data-v-828910c6></div> <!----> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>全部分类</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>DevOps</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/devops/aliyun_docker_nginx.html" class="sidebar-link">在阿里云上使用Docker部署静态站点</a></li><li><a href="/articles/devops/atguigu_docker.html" class="sidebar-link">尚硅谷_Docker的安装与卸载</a></li><li><a href="/articles/devops/atguigu_ShardingSphere5.html" aria-current="page" class="active sidebar-link">尚硅谷_ShardingSphere5</a></li><li><a href="/articles/devops/docker.html" class="sidebar-link">Docker学习笔记</a></li><li><a href="/articles/devops/docker_redis.html" class="sidebar-link">在Docker下安装Redis</a></li><li><a href="/articles/devops/git.html" class="sidebar-link">Git学习笔记</a></li><li><a href="/articles/devops/gitlab.html" class="sidebar-link">GitLab学习笔记</a></li><li><a href="/articles/devops/gradle.html" class="sidebar-link">Gradle学习笔记</a></li><li><a href="/articles/devops/idea.html" class="sidebar-link">IDEA基本使用</a></li><li><a href="/articles/devops/jdk.html" class="sidebar-link">JDK安装与配置</a></li><li><a href="/articles/devops/jenkins.html" class="sidebar-link">Jenkins学习笔记</a></li><li><a href="/articles/devops/k8s.html" class="sidebar-link">K8S学习笔记</a></li><li><a href="/articles/devops/linux.html" class="sidebar-link">Linux学习笔记</a></li><li><a href="/articles/devops/linux_deploy_java_web.html" class="sidebar-link">在Linux上部署JavaWeb应用</a></li><li><a href="/articles/devops/maven.html" class="sidebar-link">Maven安装与配置</a></li><li><a href="/articles/devops/nodejs.html" class="sidebar-link">Node.js安装与配置</a></li><li><a href="/articles/devops/shell.html" class="sidebar-link">Shell学习笔记</a></li><li><a href="/articles/devops/sonar.html" class="sidebar-link">SonarQube学习笔记</a></li><li><a href="/articles/devops/tomcat.html" class="sidebar-link">Tomcat安装与配置</a></li><li><a href="/articles/devops/typora.html" class="sidebar-link">Typora</a></li><li><a href="/articles/devops/vm.html" class="sidebar-link">VMware Workstation安装与配置</a></li><li><a href="/articles/devops/vscode.html" class="sidebar-link">Visual Studio Code 使用技巧</a></li><li><a href="/articles/devops/windows.html" class="sidebar-link">Windows实用技巧</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>后端开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/articles/frondend/" class="sidebar-heading clickable"><span>前端开发</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/articles/other/" class="sidebar-heading clickable"><span>其他</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>尚硅谷_ShardingSphere5</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>maiaimei</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2022
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">尚硅谷_ShardingSphere5</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>尚硅谷</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>2022/9/14</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>ShardingSphere</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="第01章-高性能架构模式"><a href="#第01章-高性能架构模式" class="header-anchor">#</a> 第01章 高性能架构模式</h2> <p>互联网业务兴起之后，海量用户加上海量数据的特点，单个数据库服务器已经难以满足业务需要，必须考虑数据库集群的方式来提升性能。高性能数据库集群的<code>第一种方式是“读写分离”</code>，<code>第二种方式是“数据库分片”</code>。</p> <h3 id="_1、读写分离架构"><a href="#_1、读写分离架构" class="header-anchor">#</a> 1、读写分离架构</h3> <p>**读写分离原理：**读写分离的基本原理是将数据库读写操作分散到不同的节点上，下面是其基本架构图：</p> <img src="/assets/img/362d22168bf344687ec0c206aa115807.16cc12c2.jpg"> <p><strong>读写分离的基本实现：</strong></p> <ul><li><code>主库负责处理事务性的增删改操作，从库负责处理查询操作</code>，能够有效的避免由数据更新导致的行锁，使得整个系统的查询性能得到极大的改善。</li> <li>读写分离是<code>根据 SQL 语义的分析</code>，<code>将读操作和写操作分别路由至主库与从库</code>。</li> <li>通过<code>一主多从</code>的配置方式，可以将查询请求均匀的分散到多个数据副本，能够进一步的提升系统的处理能力。</li> <li>使用<code>多主多从</code>的方式，不但能够提升系统的吞吐量，还能够提升系统的可用性，可以达到在任何一个数据库宕机，甚至磁盘物理损坏的情况下仍然不影响系统的正常运行。</li></ul> <p><strong>下图展示了根据业务需要，将用户表的写操作和读操路由到不同的数据库的方案：</strong></p> <img src="/assets/img/image-20220804223138651.ef678175.png"> <p><strong>CAP 理论：</strong></p> <p>CAP 定理（CAP theorem）又被称作布鲁尔定理（Brewer's theorem），是加州大学伯克利分校的计算机科学家埃里克·布鲁尔（Eric Brewer）在 2000 年的 ACM PODC 上提出的一个猜想。<code>对于设计分布式系统的架构师来说，CAP 是必须掌握的理论。</code></p> <p>在一个<code>分布式系统中</code>，当涉及读写操作时，只能保证一致性（Consistence）、可用性（Availability）、分区容错性（Partition Tolerance）三者中的两个，另外一个必须被牺牲。</p> <ul><li>C 一致性（Consistency）：对某个指定的客户端来说，读操作保证能够返回最新的写操作结果</li> <li>A 可用性（Availability）：非故障的节点在合理的时间内返回合理的响应<code>（不是错误和超时的响应）</code></li> <li>P 分区容忍性（Partition Tolerance）：当出现网络分区后<code>（可能是丢包，也可能是连接中断，还可能是拥塞）</code>，系统能够继续“履行职责”</li></ul> <p><strong>CAP特点：</strong></p> <ul><li><p>在实际设计过程中，每个系统不可能只处理一种数据，而是包含多种类型的数据，<code>有的数据必须选择 CP，有的数据必须选择 AP，分布式系统理论上不可能选择 CA 架构。</code></p> <ul><li>CP：如下图所示，<code>为了保证一致性</code>，当发生分区现象后，N1 节点上的数据已经更新到 y，但由于 N1 和 N2 之间的复制通道中断，数据 y 无法同步到 N2，N2 节点上的数据还是 x。<code>这时客户端 C 访问 N2 时，N2 需要返回 Error，提示客户端 C“系统现在发生了错误”，</code>这种处理方式<code>违背了可用性</code>（Availability）的要求，因此 CAP 三者只能满足 CP。</li></ul></li></ul> <img src="/assets/img/6e7d7bd54d7a4eb67918080863d354d7.e6a1f3ed.png"> <ul><li>AP：如下图所示，<code>为了保证可用性</code>，当发生分区现象后，N1 节点上的数据已经更新到 y，但由于 N1 和 N2 之间的复制通道中断，数据 y 无法同步到 N2，N2 节点上的数据还是 x。<code>这时客户端 C 访问 N2 时，N2 将当前自己拥有的数据 x 返回给客户端 C 了</code>，而实际上当前最新的数据已经是 y 了，这就<code>不满足一致性</code>（Consistency）的要求了，因此 CAP 三者只能满足 AP。注意：这里 N2 节点返回 x，虽然不是一个“正确”的结果，但是一个“合理”的结果，因为 x 是旧的数据，并不是一个错乱的值，只是不是最新的数据而已。</li></ul> <img src="/assets/img/2ccafe41de9bd7f8dec4658f004310d6.0ef5d37d.png"> <ul><li><p>CAP 理论中的 <code>C 在实践中是不可能完美实现的</code>，在数据复制的过程中，节点N1 和节点 N2 的数据并不一致（强一致性）。即使无法做到<code>强一致性</code>，但应用可以采用适合的方式达到<code>最终一致性</code>。具有如下特点：</p> <ul><li>基本可用（Basically Available）：分布式系统在出现故障时，允许损失部分可用性，即保证核心可用。</li> <li>软状态（Soft State）：允许系统存在中间状态，而该中间状态不会影响系统整体可用性。这里的中间状态就是 CAP 理论中的数据不一致。</li> <li><code>最终一致性（Eventual Consistency）：系统中的所有数据副本经过一定时间后，最终能够达到一致的状态。</code></li></ul></li></ul> <h3 id="_2、数据库分片架构"><a href="#_2、数据库分片架构" class="header-anchor">#</a> 2、数据库分片架构</h3> <p><strong>读写分离的问题：</strong></p> <p>读写分离分散了数据库读写操作的压力，但没有分散存储压力，为了满足业务数据存储的需求，就需要<code>将存储分散到多台数据库服务器上</code>。</p> <p><strong>数据分片：</strong></p> <p>将存放在单一数据库中的数据分散地存放至多个数据库或表中，以达到提升性能瓶颈以及可用性的效果。 数据分片的有效手段是对关系型数据库进行<code>分库和分表</code>。数据分片的拆分方式又分为<code>垂直分片和水平分片</code>。</p> <h4 id="_2-1、垂直分片"><a href="#_2-1、垂直分片" class="header-anchor">#</a> 2.1、垂直分片</h4> <p><strong>垂直分库：</strong></p> <p><code>按照业务拆分的方式称为垂直分片，又称为纵向拆分</code>，它的核心理念是专库专用。 在拆分之前，一个数据库由多个数据表构成，每个表对应着不同的业务。而拆分之后，则是按照业务将表进行归类，分布到不同的数据库中，从而将压力分散至不同的数据库。</p> <img src="/assets/img/71f41d46cc5c0405f4d4dc944b4350c9.b6ce3dcb.jpg"> <p>下图展示了根据业务需要，将用户表和订单表垂直分片到不同的数据库的方案：</p> <img src="/assets/img/image-20220804221855449.e6ca8d5c.png"> <p>垂直拆分可以缓解数据量和访问量带来的问题，但无法根治。<code>如果垂直拆分之后，表中的数据量依然超过单节点所能承载的阈值，则需要水平分片来进一步处理。</code></p> <p><strong>垂直分表：</strong></p> <p><code>垂直分表适合将表中某些不常用的列，或者是占了大量空间的列拆分出去。</code></p> <p>假设我们是一个婚恋网站，用户在筛选其他用户的时候，主要是用 age 和 sex 两个字段进行查询，而 nickname 和 description 两个字段主要用于展示，一般不会在业务查询中用到。description 本身又比较长，因此我们可以将这两个字段独立到另外一张表中，这样在查询 age 和 sex 时，就能带来一定的性能提升。</p> <p>垂直分表引入的复杂性主要体现在表操作的数量要增加。例如，原来只要一次查询就可以获取 name、age、sex、nickname、description，现在需要两次查询，一次查询获取 name、age、sex，另外一次查询获取 nickname、description。</p> <img src="/assets/img/136bc2f01919edcb8271df6f7e71af40.235b541b.jpg"> <p><code>水平分表适合表行数特别大的表，水平分表属于水平分片</code>。</p> <h4 id="_2-2、水平分片"><a href="#_2-2、水平分片" class="header-anchor">#</a> 2.2、水平分片</h4> <p><code>水平分片又称为横向拆分。</code> 相对于垂直分片，它不再将数据根据业务逻辑分类，而是通过某个字段（或某几个字段），根据某种规则将数据分散至多个库或表中，每个分片仅包含数据的一部分。 例如：根据主键分片，偶数主键的记录放入 0 库（或表），奇数主键的记录放入 1 库（或表），如下图所示。</p> <img src="/assets/img/image-20220804222212087.b9421cb9.png"> <p><code>单表进行切分后，是否将多个表分散在不同的数据库服务器中，可以根据实际的切分效果来确定。</code></p> <ul><li><p>**水平分表：**单表切分为多表后，新的表即使在同一个数据库服务器中，也可能带来可观的性能提升，如果性能能够满足业务要求，可以不拆分到多台数据库服务器，毕竟业务分库也会引入很多复杂性；</p></li> <li><p>**水平分库：**如果单表拆分为多表后，单台服务器依然无法满足性能要求，那就需要将多个表分散在不同的数据库服务器中。</p></li></ul> <blockquote><p><strong>阿里巴巴Java开发手册：</strong></p> <p>【推荐】单表行数超过 500 万行或者单表容量超过 2GB，才推荐进行分库分表。</p> <p>说明：如果预计三年后的数据量根本达不到这个级别，<code>请不要在创建表时就分库分表</code>。</p></blockquote> <h3 id="_3、读写分离和数据分片架构"><a href="#_3、读写分离和数据分片架构" class="header-anchor">#</a> 3、读写分离和数据分片架构</h3> <p>下图展现了将数据分片与读写分离一同使用时，应用程序与数据库集群之间的复杂拓扑关系。</p> <img src="/assets/img/image-20220804223321167.4b67e2f9.png"> <h3 id="_4、实现方式"><a href="#_4、实现方式" class="header-anchor">#</a> 4、实现方式</h3> <p>读写分离和数据分片具体的实现方式一般有两种：  <code>程序代码封装</code>和<code>中间件封装</code>。</p> <h4 id="_4-1、程序代码封装"><a href="#_4-1、程序代码封装" class="header-anchor">#</a> 4.1、程序代码封装</h4> <p>程序代码封装指在代码中抽象一个<code>数据访问层（或中间层封装）</code>，实现读写操作分离和数据库服务器连接的管理。</p> <p>**其基本架构是：**以读写分离为例</p> <img src="/assets/img/f8d538f9201e3ebee37dfdcd1922e9df.e409284b.jpg"> <h4 id="_4-2、中间件封装"><a href="#_4-2、中间件封装" class="header-anchor">#</a> 4.2、中间件封装</h4> <p>中间件封装指的是<code>独立一套系统出来</code>，实现读写操作分离和数据库服务器连接的管理。对于业务服务器来说，访问中间件和访问数据库没有区别，在业务服务器看来，中间件就是一个数据库服务器。</p> <p>**基本架构是：**以读写分离为例</p> <img src="/assets/img/2a2dba7f07581fd055d9cd5a3aa8388e.5d9679c8.jpg"> <h4 id="_4-3、常用解决方案"><a href="#_4-3、常用解决方案" class="header-anchor">#</a> 4.3、常用解决方案</h4> <p>Apache ShardingSphere（程序级别和中间件级别）</p> <p>MyCat（数据库中间件）</p> <h2 id="第02章-shardingsphere"><a href="#第02章-shardingsphere" class="header-anchor">#</a> 第02章 ShardingSphere</h2> <h3 id="_1、简介"><a href="#_1、简介" class="header-anchor">#</a> 1、简介</h3> <p>官网：https://shardingsphere.apache.org/index_zh.html</p> <p>文档：https://shardingsphere.apache.org/document/5.1.1/cn/overview/</p> <p>Apache ShardingSphere 由 JDBC、Proxy 和 Sidecar（规划中）这 3 款既能够独立部署，又支持混合部署配合使用的产品组成。</p> <h3 id="_2、shardingsphere-jdbc"><a href="#_2、shardingsphere-jdbc" class="header-anchor">#</a> 2、ShardingSphere-JDBC</h3> <p><strong>程序代码封装</strong></p> <p>定位为轻量级 Java 框架，<code>在 Java 的 JDBC 层提供的额外服务</code>。 它使用客户端直连数据库，<code>以 jar 包形式提供服务</code>，无需额外部署和依赖，可理解为增强版的 JDBC 驱动，完全兼容 JDBC 和各种 ORM 框架。</p> <img src="/assets/img/image-20220804195402870.24199289.png"> <h3 id="_3、shardingsphere-proxy"><a href="#_3、shardingsphere-proxy" class="header-anchor">#</a> 3、ShardingSphere-Proxy</h3> <p><strong>中间件封装</strong></p> <p>定位为透明化的<code>数据库代理端</code>，提供封装了数据库二进制协议的服务端版本，用于完成对异构语言的支持。 目前提供 MySQL 和 PostgreSQL版本，它可以使用任何兼容 MySQL/PostgreSQL 协议的访问客户端（如：MySQL Command Client, MySQL Workbench, Navicat 等）操作数据，对 DBA 更加友好。</p> <img src="/assets/img/image-20220804195432673.b6209afe.png"> <h2 id="第03章-mysql主从同步"><a href="#第03章-mysql主从同步" class="header-anchor">#</a> 第03章 MySQL主从同步</h2> <h3 id="_1、mysql主从同步原理"><a href="#_1、mysql主从同步原理" class="header-anchor">#</a> 1、MySQL主从同步原理</h3> <img src="/assets/img/image-20220714133617856.46f2a800.png"> <p><strong>基本原理：</strong></p> <p>slave会从master读取binlog来进行数据同步</p> <p><strong>具体步骤：</strong></p> <ul><li><code>step1：</code>master将数据改变记录到<code>二进制日志（binary log）</code>中。</li> <li><code>step2：</code> 当slave上执行 <code>start slave</code> 命令之后，slave会创建一个 <code>IO 线程</code>用来连接master，请求master中的binlog。</li> <li><code>step3：</code>当slave连接master时，master会创建一个 <code>log dump 线程</code>，用于发送 binlog 的内容。在读取 binlog 的内容的操作中，会对主节点上的 binlog 加锁，当读取完成并发送给从服务器后解锁。</li> <li><code>step4：</code>IO 线程接收主节点 binlog dump 进程发来的更新之后，保存到 <code>中继日志（relay log）</code> 中。</li> <li><code>step5：</code>slave的<code>SQL线程</code>，读取relay log日志，并解析成具体操作，从而实现主从操作一致，最终数据一致。</li></ul> <h3 id="_2、一主多从配置"><a href="#_2、一主多从配置" class="header-anchor">#</a> 2、一主多从配置</h3> <p>服务器规划：使用<code>docker</code>方式创建，<code>主从服务器IP一致，端口号不一致</code></p> <img src="/assets/img/image-20220807183231101.ef7b4ced.png"> <ul><li>主服务器：容器名<code>atguigu-mysql-master</code>，端口<code>3306</code></li> <li>从服务器：容器名<code>atguigu-mysql-slave1</code>，端口<code>3307</code></li> <li>从服务器：容器名<code>atguigu-mysql-slave2</code>，端口<code>3308</code></li></ul> <p>**注意：**如果此时防火墙是开启的，<code>则先关闭防火墙，并重启docker</code>，否则后续安装的MySQL无法启动</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#关闭docker</span>
systemctl stop docker
<span class="token comment">#关闭防火墙</span>
systemctl stop firewalld
<span class="token comment">#启动docker</span>
systemctl start docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_2-1、准备主服务器"><a href="#_2-1、准备主服务器" class="header-anchor">#</a> 2.1、准备主服务器</h4> <ul><li><strong>step1：在docker中创建并启动MySQL主服务器：</strong><code>端口3306</code></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -d <span class="token punctuation">\</span>
-p <span class="token number">3306</span>:3306 <span class="token punctuation">\</span>
-v /atguigu/mysql/master/conf:/etc/mysql/conf.d <span class="token punctuation">\</span>
-v /atguigu/mysql/master/data:/var/lib/mysql <span class="token punctuation">\</span>
-e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token punctuation">\</span>
--name atguigu-mysql-master <span class="token punctuation">\</span>
mysql:8.0.29
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><strong>step2：创建MySQL主服务器配置文件：</strong></li></ul> <p>默认情况下MySQL的binlog日志是自动开启的，可以通过如下配置定义一些可选配置</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /atguigu/mysql/master/conf/my.cnf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>配置如下内容</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code>[mysqld]
<span class="token comment"># 服务器唯一id，默认值1</span>
<span class="token attr-name">server-id</span><span class="token punctuation">=</span><span class="token attr-value">1</span>
<span class="token comment"># 设置日志格式，默认值ROW</span>
<span class="token attr-name">binlog_format</span><span class="token punctuation">=</span><span class="token attr-value">STATEMENT</span>
<span class="token comment"># 二进制日志名，默认binlog</span>
<span class="token comment"># log-bin=binlog</span>
<span class="token comment"># 设置需要复制的数据库，默认复制全部数据库</span>
<span class="token comment">#binlog-do-db=mytestdb</span>
<span class="token comment"># 设置不需要复制的数据库</span>
<span class="token comment">#binlog-ignore-db=mysql</span>
<span class="token comment">#binlog-ignore-db=infomation_schema</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>重启MySQL容器</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker restart atguigu-mysql-master
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>binlog格式说明：</code></p> <ul><li>binlog_format=STATEMENT：日志记录的是主机数据库的<code>写指令</code>，性能高，但是now()之类的函数以及获取系统参数的操作会出现主从数据不同步的问题。</li> <li>binlog_format=ROW（默认）：日志记录的是主机数据库的<code>写后的数据</code>，批量操作时性能较差，解决now()或者  user()或者  @@hostname 等操作在主从机器上不一致的问题。</li> <li>binlog_format=MIXED：是以上两种level的混合使用，有函数用ROW，没函数用STATEMENT，但是无法识别系统变量</li></ul> <p><code>binlog-ignore-db和binlog-do-db的优先级问题：</code></p> <img src="/assets/img/0.08703112216569037.132e239e.png"> <ul><li><strong>step3：使用命令行登录MySQL主服务器：</strong></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#进入容器：env LANG=C.UTF-8 避免容器中显示中文乱码</span>
docker <span class="token builtin class-name">exec</span> -it atguigu-mysql-master <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token comment">#进入容器内的mysql命令行</span>
mysql -uroot -p
<span class="token comment">#修改默认密码校验方式</span>
ALTER <span class="token environment constant">USER</span> <span class="token string">'root'</span>@<span class="token string">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><strong>step4：主机中创建slave用户：</strong></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建slave用户</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'atguigu_slave'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
<span class="token comment">-- 设置密码</span>
<span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">'atguigu_slave'</span><span class="token variable">@'%'</span> IDENTIFIED <span class="token keyword">WITH</span> mysql_native_password <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
<span class="token comment">-- 授予复制权限</span>
<span class="token keyword">GRANT</span> <span class="token keyword">REPLICATION</span> SLAVE <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'atguigu_slave'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
<span class="token comment">-- 刷新权限</span>
FLUSH <span class="token keyword">PRIVILEGES</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><strong>step5：主机中查询master状态：</strong></li></ul> <p>执行完此步骤后<code>不要再操作主服务器MYSQL</code>，防止主服务器状态值变化</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> MASTER <span class="token keyword">STATUS</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>记下<code>File</code>和<code>Position</code>的值。执行完此步骤后不要再操作主服务器MYSQL，防止主服务器状态值变化。</p> <img src="data:image/png;base64,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"> <h4 id="_2-2、准备从服务器"><a href="#_2-2、准备从服务器" class="header-anchor">#</a> 2.2、准备从服务器</h4> <p>可以配置多台从机slave1、slave2...，这里以配置slave1为例</p> <ul><li><strong>step1：在docker中创建并启动MySQL从服务器：</strong><code>端口3307</code></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -d <span class="token punctuation">\</span>
-p <span class="token number">3307</span>:3306 <span class="token punctuation">\</span>
-v /atguigu/mysql/slave1/conf:/etc/mysql/conf.d <span class="token punctuation">\</span>
-v /atguigu/mysql/slave1/data:/var/lib/mysql <span class="token punctuation">\</span>
-e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token punctuation">\</span>
--name atguigu-mysql-slave1 <span class="token punctuation">\</span>
mysql:8.0.29
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><strong>step2：创建MySQL从服务器配置文件：</strong></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /atguigu/mysql/slave1/conf/my.cnf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>配置如下内容：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code>[mysqld]
<span class="token comment"># 服务器唯一id，每台服务器的id必须不同，如果配置其他从机，注意修改id</span>
<span class="token attr-name">server-id</span><span class="token punctuation">=</span><span class="token attr-value">2</span>
<span class="token comment"># 中继日志名，默认xxxxxxxxxxxx-relay-bin</span>
<span class="token comment">#relay-log=relay-bin</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>重启MySQL容器</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker restart atguigu-mysql-slave1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><strong>step3：使用命令行登录MySQL从服务器：</strong></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#进入容器：</span>
docker <span class="token builtin class-name">exec</span> -it atguigu-mysql-slave1 <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token comment">#进入容器内的mysql命令行</span>
mysql -uroot -p
<span class="token comment">#修改默认密码校验方式</span>
ALTER <span class="token environment constant">USER</span> <span class="token string">'root'</span>@<span class="token string">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><strong>step4：在从机上配置主从关系：</strong></li></ul> <p>在<strong>从机</strong>上执行以下SQL操作</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>CHANGE MASTER <span class="token keyword">TO</span> MASTER_HOST<span class="token operator">=</span><span class="token string">'192.168.100.201'</span><span class="token punctuation">,</span> 
MASTER_USER<span class="token operator">=</span><span class="token string">'atguigu_slave'</span><span class="token punctuation">,</span>MASTER_PASSWORD<span class="token operator">=</span><span class="token string">'123456'</span><span class="token punctuation">,</span> MASTER_PORT<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>
MASTER_LOG_FILE<span class="token operator">=</span><span class="token string">'binlog.000003'</span><span class="token punctuation">,</span>MASTER_LOG_POS<span class="token operator">=</span><span class="token number">1357</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_2-3、启动主从同步"><a href="#_2-3、启动主从同步" class="header-anchor">#</a> 2.3、启动主从同步</h4> <p>启动从机的复制功能，执行SQL：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">START</span> SLAVE<span class="token punctuation">;</span>
<span class="token comment">-- 查看状态（不需要分号）</span>
<span class="token keyword">SHOW</span> SLAVE <span class="token keyword">STATUS</span>\G
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>**两个关键进程：**下面两个参数都是Yes，则说明主从配置成功！</p> <img src="/assets/img/image-20220715000533951.156ea525.png"> <h4 id="_2-4、实现主从同步"><a href="#_2-4、实现主从同步" class="header-anchor">#</a> 2.4、实现主从同步</h4> <p>在主机中执行以下SQL，在从机中查看数据库、表和数据是否已经被同步</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> db_user<span class="token punctuation">;</span>
<span class="token keyword">USE</span> db_user<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_user <span class="token punctuation">(</span>
 id <span class="token keyword">BIGINT</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
 uname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_user<span class="token punctuation">(</span>uname<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'zhang3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_user<span class="token punctuation">(</span>uname<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>@<span class="token variable">@hostname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_2-5、停止和重置"><a href="#_2-5、停止和重置" class="header-anchor">#</a> 2.5、停止和重置</h4> <p>需要的时候，可以使用如下SQL语句</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 在从机上执行。功能说明：停止I/O 线程和SQL线程的操作。</span>
stop slave<span class="token punctuation">;</span> 

<span class="token comment">-- 在从机上执行。功能说明：用于删除SLAVE数据库的relaylog日志文件，并重新启用新的relaylog文件。</span>
reset slave<span class="token punctuation">;</span>

<span class="token comment">-- 在主机上执行。功能说明：删除所有的binglog日志文件，并将日志索引文件清空，重新开始所有新的日志文件。</span>
<span class="token comment">-- 用于第一次进行搭建主从库时，进行主库binlog初始化工作；</span>
reset master<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_2-6、常见问题"><a href="#_2-6、常见问题" class="header-anchor">#</a> <strong>2.6、常见问题</strong></h4> <h5 id="问题1"><a href="#问题1" class="header-anchor">#</a> 问题1</h5> <p>启动主从同步后，常见错误是<code>Slave_IO_Running： No 或者 Connecting</code> 的情况，此时查看下方的 <code>Last_IO_ERROR</code>错误日志，根据日志中显示的错误信息在网上搜索解决方案即可</p> <img src="/assets/img/image-20220714235426120.ce35c1b1.png"> <p><strong>典型的错误例如：</strong><code>Last_IO_Error: Got fatal error 1236 from master when reading data from binary log: 'Client requested master to start replication from position &gt; file size'</code></p> <p><strong>解决方案：</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 在从机停止slave</span>
SLAVE STOP<span class="token punctuation">;</span>

<span class="token comment">-- 在主机查看mater状态</span>
<span class="token keyword">SHOW</span> MASTER <span class="token keyword">STATUS</span><span class="token punctuation">;</span>
<span class="token comment">-- 在主机刷新日志</span>
FLUSH LOGS<span class="token punctuation">;</span>
<span class="token comment">-- 再次在主机查看mater状态（会发现File和Position发生了变化）</span>
<span class="token keyword">SHOW</span> MASTER <span class="token keyword">STATUS</span><span class="token punctuation">;</span>
<span class="token comment">-- 修改从机连接主机的SQL，并重新连接即可</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="问题2"><a href="#问题2" class="header-anchor">#</a> 问题2</h5> <p>启动docker容器后提示 <code>WARNING: IPv4 forwarding is disabled. Networking will not work.</code></p> <img src="/assets/img/image-20220715004850504.66975d7f.png"> <p>此错误，虽然不影响主从同步的搭建，但是如果想从远程客户端通过以下方式连接docker中的MySQL则没法连接</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>administrator<span class="token operator">&gt;</span>mysql -h <span class="token number">192.168</span>.100.201 -P <span class="token number">3306</span> -u root -p
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>解决方案：</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#修改配置文件：</span>
<span class="token function">vim</span> /usr/lib/sysctl.d/00-system.conf
<span class="token comment">#追加</span>
net.ipv4.ip_forward<span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">#接着重启网络</span>
systemctl restart network
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="第04章-shardingsphere-jdbc读写分离"><a href="#第04章-shardingsphere-jdbc读写分离" class="header-anchor">#</a> 第04章 ShardingSphere-JDBC读写分离</h2> <h3 id="_1、创建springboot程序"><a href="#_1、创建springboot程序" class="header-anchor">#</a> 1、创建SpringBoot程序</h3> <h4 id="_1-1、创建项目"><a href="#_1-1、创建项目" class="header-anchor">#</a> 1.1、创建项目</h4> <p>项目类型：Spring Initializr</p> <p>SpringBoot脚手架：http://start.aliyun.com</p> <p>项目名：sharding-jdbc-demo</p> <p>SpringBoot版本：2.3.7.RELEASE</p> <h4 id="_1-2、添加依赖"><a href="#_1-2、添加依赖" class="header-anchor">#</a> 1.2、添加依赖</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shardingsphere-jdbc-core-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h4 id="_1-3、创建实体类"><a href="#_1-3、创建实体类" class="header-anchor">#</a> 1.3、创建实体类</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;t_user&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> uname<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_1-4、创建mapper"><a href="#_1-4、创建mapper" class="header-anchor">#</a> 1.4、创建Mapper</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_1-5、配置读写分离"><a href="#_1-5、配置读写分离" class="header-anchor">#</a> 1.5、配置读写分离</h4> <p>application.properties：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># 应用名称</span>
<span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">sharging-jdbc-demo</span>
<span class="token comment"># 开发环境设置</span>
<span class="token attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token attr-value">dev</span>
<span class="token comment"># 内存模式</span>
<span class="token attr-name">spring.shardingsphere.mode.type</span><span class="token punctuation">=</span><span class="token attr-value">Memory</span>

<span class="token comment"># 配置真实数据源</span>
<span class="token attr-name">spring.shardingsphere.datasource.names</span><span class="token punctuation">=</span><span class="token attr-value">master,slave1,slave2</span>

<span class="token comment"># 配置第 1 个数据源</span>
<span class="token attr-name">spring.shardingsphere.datasource.master.type</span><span class="token punctuation">=</span><span class="token attr-value">com.zaxxer.hikari.HikariDataSource</span>
<span class="token attr-name">spring.shardingsphere.datasource.master.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span>
<span class="token attr-name">spring.shardingsphere.datasource.master.jdbc-url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://192.168.100.201:3306/db_user</span>
<span class="token attr-name">spring.shardingsphere.datasource.master.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name">spring.shardingsphere.datasource.master.password</span><span class="token punctuation">=</span><span class="token attr-value">123456</span>

<span class="token comment"># 配置第 2 个数据源</span>
<span class="token attr-name">spring.shardingsphere.datasource.slave1.type</span><span class="token punctuation">=</span><span class="token attr-value">com.zaxxer.hikari.HikariDataSource</span>
<span class="token attr-name">spring.shardingsphere.datasource.slave1.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span>
<span class="token attr-name">spring.shardingsphere.datasource.slave1.jdbc-url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://192.168.100.201:3307/db_user</span>
<span class="token attr-name">spring.shardingsphere.datasource.slave1.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name">spring.shardingsphere.datasource.slave1.password</span><span class="token punctuation">=</span><span class="token attr-value">123456</span>

<span class="token comment"># 配置第 3 个数据源</span>
<span class="token attr-name">spring.shardingsphere.datasource.slave2.type</span><span class="token punctuation">=</span><span class="token attr-value">com.zaxxer.hikari.HikariDataSource</span>
<span class="token attr-name">spring.shardingsphere.datasource.slave2.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span>
<span class="token attr-name">spring.shardingsphere.datasource.slave2.jdbc-url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://192.168.100.201:3308/db_user</span>
<span class="token attr-name">spring.shardingsphere.datasource.slave2.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name">spring.shardingsphere.datasource.slave2.password</span><span class="token punctuation">=</span><span class="token attr-value">123456</span>

<span class="token comment"># 读写分离类型，如: Static，Dynamic</span>
<span class="token attr-name">spring.shardingsphere.rules.readwrite-splitting.data-sources.myds.type</span><span class="token punctuation">=</span><span class="token attr-value">Static</span>
<span class="token comment"># 写数据源名称</span>
<span class="token attr-name">spring.shardingsphere.rules.readwrite-splitting.data-sources.myds.props.write-data-source-name</span><span class="token punctuation">=</span><span class="token attr-value">master</span>
<span class="token comment"># 读数据源名称，多个从数据源用逗号分隔</span>
<span class="token attr-name">spring.shardingsphere.rules.readwrite-splitting.data-sources.myds.props.read-data-source-names</span><span class="token punctuation">=</span><span class="token attr-value">slave1,slave2</span>

<span class="token comment"># 负载均衡算法名称</span>
<span class="token attr-name">spring.shardingsphere.rules.readwrite-splitting.data-sources.myds.load-balancer-name</span><span class="token punctuation">=</span><span class="token attr-value">alg_round</span>

<span class="token comment"># 负载均衡算法配置</span>
<span class="token comment"># 负载均衡算法类型</span>
<span class="token attr-name">spring.shardingsphere.rules.readwrite-splitting.load-balancers.alg_round.type</span><span class="token punctuation">=</span><span class="token attr-value">ROUND_ROBIN</span>
<span class="token attr-name">spring.shardingsphere.rules.readwrite-splitting.load-balancers.alg_random.type</span><span class="token punctuation">=</span><span class="token attr-value">RANDOM</span>
<span class="token attr-name">spring.shardingsphere.rules.readwrite-splitting.load-balancers.alg_weight.type</span><span class="token punctuation">=</span><span class="token attr-value">WEIGHT</span>
<span class="token attr-name">spring.shardingsphere.rules.readwrite-splitting.load-balancers.alg_weight.props.slave1</span><span class="token punctuation">=</span><span class="token attr-value">1</span>
<span class="token attr-name">spring.shardingsphere.rules.readwrite-splitting.load-balancers.alg_weight.props.slave2</span><span class="token punctuation">=</span><span class="token attr-value">2</span>

<span class="token comment"># 打印SQl</span>
<span class="token attr-name">spring.shardingsphere.props.sql-show</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h3 id="_2、测试"><a href="#_2、测试" class="header-anchor">#</a> 2、测试</h3> <h4 id="_2-1、读写分离测试"><a href="#_2-1、读写分离测试" class="header-anchor">#</a> 2.1、读写分离测试</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">ReadwriteTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 写入数据的测试
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setUname</span><span class="token punctuation">(</span><span class="token string">&quot;张三丰&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_2-2、事务测试"><a href="#_2-2、事务测试" class="header-anchor">#</a> 2.2、事务测试</h4> <p>为了保证主从库间的事务一致性，避免跨服务的分布式事务，ShardingSphere-JDBC的<code>主从模型中，事务中的数据读写均用主库</code>。</p> <ul><li>不添加@Transactional：insert对主库操作，select对从库操作</li> <li>添加@Transactional：则insert和select均对主库操作</li> <li>**注意：**在JUnit环境下的@Transactional注解，默认情况下就会对事务进行回滚（即使在没加注解@Rollback，也会对事务回滚）</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
     * 事务测试
     */</span>
<span class="token annotation punctuation">@Transactional</span><span class="token comment">//开启事务</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTrans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setUname</span><span class="token punctuation">(</span><span class="token string">&quot;铁锤&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_2-3、负载均衡测试"><a href="#_2-3、负载均衡测试" class="header-anchor">#</a> 2.3、负载均衡测试</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token comment">/**
     * 读数据测试
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//执行第二次测试负载均衡</span>
    users<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>也可以在web请求中测试负载均衡</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/userController&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 测试负载均衡策略
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;selectAll&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        users<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="第05章-shardingsphere-jdbc垂直分片"><a href="#第05章-shardingsphere-jdbc垂直分片" class="header-anchor">#</a> 第05章 ShardingSphere-JDBC垂直分片</h2> <h3 id="_1、准备服务器"><a href="#_1、准备服务器" class="header-anchor">#</a> 1、准备服务器</h3> <p>服务器规划：使用<code>docker</code>方式创建如下容器</p> <img src="data:image/png;base64,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EBERkXAsMIiIiEg4FhhEREQkHAsMIiIiEo4FBhEREQm3yOoOJKIjR47g5ZdfRiAQQCAQQDAYtLpLcS85ORlZWVmQZRkPPvggHA6H1V0isgTzwzzmR3xigSHQu+++iz179uCNN96wuiu288UXX+Dw4cM4fPgw/vSnP2H79u249957re4WUcwwP+aP+RGfWGAI0tnZiV//+te4cOECbrjhBlRUVOD222/HLbfcwmp6kubmZjz77LMAgMrKStx3333IyMjA8ePHsW/fPrz22muorq7Gc889h+zsbIt7SxR9zA/jmB/2wQJDgH379uGZZ54BADz++OP40Y9+hGuuucbiXsWnY8eOoaWlBVdffTV+97vf4a677tLvW7duHdatW4enn34aL7zwAn71q1+htbUVN9xwg4U9Joou5odxzA974SHPBfL7/Xo4PPHEE6isrGQ4zODLL7/Ejh07cOnSJfziF7+ICIdwTz75JO699158+umn2LZtW4x7SRQ7zA/jmB/2wwJjAT777DN4vV4AwE9/+lOUl5db3KP4tn//fnz88cf45je/iR/84AezPra2thYrVqxAf38/FEWJUQ+JYof5YQ7zw35YYCzA008/jbGxMaxfvx6bN2+2ujtx7csvv8Rzzz0HAPjZz3425+PT0tLw8MMPAwCampqi2jciKzA/jGN+2BMLjHnq7e3FgQMHsHTpUmzfvh1JSUlWdymuvfLKK/rsIysry9BzSktLkZaWhv7+frz99ttR7iFR7DA/zGF+2BMLjHn6/e9/DwB49NFHsXLlSot7E//+/Oc/AwAqKioMPyclJQWlpaUAgJdffjkq/SKyAvPDHOaHPbHAmId//vOf6O/vx/Lly+fcCyTg3//+N44cOYLU1NQZD2bN5Dvf+Q4A4PXXX8elS5ei0T2imGJ+mMP8sC8WGPPwwgsvAAAeeughnvg2oKurC1999RU2bNiAxYsXm3rumjVrcOutt+I///kPjh49GqUeEsUO88Mc5od9scAw6fTp0+ju7obD4UBZWZnV3bGFv/71rwCAgoKCeT3/gQceAAAcOHBAWJ+IrMD8MI/5YV8sMEx67bXXoKoqiouLcd1111ndnbgXDAZx/PhxfO1rX0Nubu682vjWt74FAPy4Gdke88Mc5oe9scAwSaum77vvPot7Yg/vvfceQqEQbrvtNqSlpc2rjVtvvRXJyck4ceIEzpw5I7iHRLHD/DCH+WFvLDBM0PbxUlJScOedd1rdHVs4duwYACzo57V48WKsXbsWoVAIAwMDorpGFFPMD/OYH/bGAsME7STyPffcY/qw0ZVqaGgIALBhw4YFtaN9aREPapFdMT/MY37YGwsME7Tlzfz8fIt7Yh/aDGTdunULakebwbz11lsL7hORFZgf5jE/7I0FhkEXL17E4OAgAOCee+6xuDf2cObMGYyNjcHlcmHZsmULaiszMxMAcPz4cYRCIRHdI4oZ5od5zA/7Y4Fh0EcffYQLFy4gPT0d119/vdXdsYWPP/4YAOByuRbc1o033oilS5fiwoUL+PTTTxfcHlEsMT/MY37YHwsMg44fPw7g8l4eze3kyZMAxAQEANxyyy0ALgcPkV0wP8xjftgfCwyD3nnnHQAMCDO0gXzTTTcJaU8LCC14iOyC+WEe88P+WGAY9P777wNY2MelrjTaQBYdEJyBkN0wP8xjftgfCwyD3n33XSxZsgRr1661uiu2IXIPFeAMhOyL+WEe88P+WGAYMDo6ivPnz2PlypVYtGiR1d2xjdOnTwOAsENtTqcTAPjX+MhWmB/zw/ywPxYYBoyMjAAAVqxYYXFP7OOrr77Cf//7XyQlJSE1NVVImw6HA8DE9xMQ2QXzwzzmR2JggWGAFhD8eJlxwWAQoVAI1113Ha666iohbWrfRcCAIDthfpjH/EgMLDAM4AzEPG0Qz/cLiqazdOlSLF68GKqq4osvvhDWLlE0MT/MY34kBhYYBnAGYp4WENqypChc5iS7YX6Yx/xIDCwwDOAMxLxoBQSXOclumB/mMT8SAwsMA7RTxyKX6xLd+Pg4AAg7oKW57rrrItoninfMD/OYH4mBBYYBFy5cAABIkmRxT+xD+5ktWbJEaLva/wOtfaJ4x/wwj/mRGFhgGMCAME9VVQDif2Za4GjtE8U7O+dHMBhEVVUVAoFATK/L/EgMLDAM0H4ZRVfTwMQArqiogKIowtu2UrRnIAwIsguR+REIBPDII4/E/A0/1pgfiYEFhgF2noFYJdozEC5xkl0wP8xjfiQGFhgGRGsFIxAI4Mc//jEGBwdRWVmJioqKWU83e71eeL1e/d+TVz+0f8uyPKUtv98PWZan3KcoCmpqatDe3g5ZluH3+4W8tmiFKmcgZDei8kNRFJSVlWFoaAhlZWWoqamZdRyoqoqamhp93BcXF0esfPj9fj1TZFmGoihTnuPz+aa0O1OWaNspBw4cQHFx8Zz9mw3zIzGwwDAgWr/sbrcbzz//PLKystDU1IS2trZ5fyxLVVU0NDSgtLQUiqKgsbERQ0NDACYCwefzobu7G4qioLS0FA0NDfog279/P5KTk6EoCkpKSoS8tmgVZTykRXYjKj9kWUZHRwcyMzPR0dGB+vr6GdtUVRW7du2C0+mEoihQFAV1dXXweDwRRUZrayvy8vKgKAoyMzOnPOfcuXM4ceKE/vi5suTs2bN49dVX5+zfXJgfiYEFRoLRvinQ4XAgPz8fwWAQPp8PVVVVevGSnZ2N8fFxfRBnZWVh48aNlvWZiMQaGhrC8PAwysvL9dtkWUZhYSEGBgb024qKipCZmQkAOHXqFMbHxyOeU15ejlWrVgGAoSwBgNLSUm4HEQCAX+1nwJIlS3Dp0iWoqoprr73W6u5MS5IkbN26FdXV1ZBlGUVFRdi2bZt+f2VlZcTj09PTMTY2BmDi65CjtRQpeqYQzQO3RNFgVX7MNK7Dv67c6XTqjxkdHUVKSsqcWTBTlqSlpSE1NRXLli1bcN+ZH4mBBYYBkiTh3LlzuHDhQtwWGMDEqkVbW5u+PNrc3KzPRpqamiDL8pTnjI6ORqUv0fo4WLQOfxFFi1X5MTw8DFVVp4yVjIwMw88ZGxubci5spiwR+dcxmR+JgVskBsTLZ6czMjLQ39+vD+Senh4MDg4CmBjc7e3tACYGz4YNGwBMFB25ubnw+Xx6/wOBAPbu3RvVvkbrMFW0Pr5GFC1W5EdmZiZcLhf27dun36YoCvr7+2fcDl29ejWAiVwBJvrb0tKiT0JimSXMj8TAAsOAaB4McjgcKC0tNfQpksLCQrhcLhQUFECWZZw5cwZZWVl6O8nJyRGnv7XVC4/HA6fTifz8fMiyjJaWFjz88MPCX0u4aH0cjDMQshuR+eF2u3H33XfP+SkSSZKwbds2jIyM6Jmwe/duNDY2zniQ3OFwoLa2Fs3NzZBlGfn5+bj//vv1MxhA7LKE+ZEYuEViQLRnICUlJYY+vSFJEurr61FfX6/f9thjjxlqx+PxwOPxTLldCx/Roj0DYUCQXYjOj5nG8mTT5UW46bLC7Xajs7Mz4rZNmzYZur7D4cDu3bvn7JcRzI/EwBUMA+Jli8ROoj0D4RIn2QXzwzzmR2LgCoYBy5cvBwD9UxfR5PV60draGnFbeno6vF4v3G531K8vSkpKCoCJz8WL9Pnnn0e0TxTvopkfiZIXkzE/EgMLDAOcTicA4PTp01G/ltHlz3in7fOKPFkOXA7p+f5BMqJYi2Z+JEpeTMb8SAzcIjFAC4jPPvvM4p7YR7QCQmuPAUF2wfwwj/mRGFhgGBDLFYxEoQ1gkcvC58+fx8WLFyFJEpKTk4W1SxRNzA/zmB+JgQWGAZyBmOdwOJCUlITPP/8cX331lZA2ubxJdsT8MI/5kRhYYBjAGYh5V111Fa699lqEQiFhB7W4vEl2xPwwj/mRGFhgGLBs2TIsXboUn3zyCS5dumR1d2xjxYoVAMTN3EZGRgBcPpVPZAfMj/lhftgfCwyDbr/9dly4cAHvvfee1V2xjZtvvhnAxPcbiPDRRx8BmP27FIjiEfPDPOaH/bHAMOi2224DABw7dszintiHNpD/9a9/CWlPCwgteIjsgvlhHvPD/lhgGHTHHXcAAAYGBizuiX1oA1l0QHAGQnbD/DCP+WF/LDAMWrNmDQAGhBnaQBa9xMkZCNkN88M85of9scAw6JZbbsGSJUtw6tQpftzMIJF7qJ9++inOnz+PJUuW4MYbb1xwe0SxxPwwj/lhfywwDFq8eLH+1ehvvvmmxb2xh+XLlyMtLQ3Dw8MYHR1dUFtDQ0MAJmaCSUlJIrpHFDPMD/OYH/bHAsOE7373uwCA3t5ei3tiH3feeScA4O23315QO9rhuLvuumvBfSKyAvPDPOaHvbHAMOG+++7DokWL8Oabb+LixYtWd8cWMjMzAQB9fX0Lakfbu87JyVlwn4iswPwwj/lhbywwTLjhhhuQk5OD8fFxftzMIG0GspCf18WLF/Hee+8hKSkJ2dnZorpGFFPMD/OYH/bGAsMkbZnz9ddft7gn9rB27VokJSXh/fffn/cXF33wwQf44osvsGrVKv4VPrI15oc5zA97Y4Fh0re//W1IkoTOzk58/vnnVncn7jkcDqxZswb/+9//0N/fP682/v73vwMAZFkW2TWimGN+mMP8sDcWGCatWLECBQUFCAaD6OjosLo7tqDN2rq7u+f1/FdeeQUAsGnTJmF9IrIC88M85od9scCYhx/+8IcAgPb2dpw7d87i3sS/wsJCXHXVVejr6zN9uO348eP44IMP9P1rIrtjfpjD/LAvFhjz8I1vfAO5ubk4c+YM/vjHP1rdnbj39a9/HevXr8fZs2fx1ltvmXru3/72NwCXT+AT2R3zwxzmh32xwJinRx55BADw3HPP4ZNPPrG4N/Hv+9//PgCgra3N8HPGx8fh8/kAAN/73vei0i8iKzA/zGF+2BMLjHnKz8/Hpk2bcP78eezcuROhUMjqLsW1Bx54ADfffDMOHTqEwcFBQ8/x+XwYGxtDbm4u1q1bF+UeEsUO88Mc5oc9scBYgCeffBJpaWk4cuQIWlparO5OXLv66qvx6KOPAgB++9vfzvn4sbEx/OEPfwAAVFZWRrVvRFZgfhjH/LAnFhgLcP3118Pj8QAAnn32Wezbt8/iHsW3oqIifRYy195zbW0tTp8+jdzcXH68jBIS88Mc5of9sMBYoJKSEjzxxBMAgGeeeQZNTU08GT6Dq6++GnV1dVi0aBF+85vfzHhg6+mnn8Y//vEP3Hjjjdi1a1eMe0kUO8wP45gf9nNVbW1trYiGmpqaAACPP/64iOZsJScnBzfddBPeeOMNHDp0CH/5y1+waNEiXLp0CZIkQZIkq7sYN7SvSu7r68NLL70EALjmmmuwdOlSvPPOO2hoaEBnZycAYM+ePVi1apVlfY13iTLmEuV1zBfzwzjmhxixGnNJIUGni7RlKEVRRDRnS++++y727NmDN954w+qu2Nry5cuxfft23HvvvVZ3Ja4lyphLlNexUMwPMZgfc4vVmOMHgwW6/fbbsWfPHhw5cgQvv/wyAoEAAoEAgsGg1V2Le8nJycjKyoIsy3jwwQfhcDis7hJRTDE/5o/5EZ9YYETB+vXrsX79equ7QUQ2xPygRMFDnkRERCQcCwwiIiISjgUGERERCccCg4iIiIRjgUFERETCscAgIiIi4VhgEBERkXAsMIiIiEg4FhhxxO/3w+v1AgBUVUVNTc0V/+eTiWh64XkRDAZRVVWFQCBgSV+svj7FJxYYREREJBwLDCIiIhKOBYaFFEWBLMuQZRkVFRU4c+bMlMdoWyXa4/x+/6xtBoNBVFRURGytKIqCiooK/UuTwq+rLbFOd63w+xRFQU1NDdrb2w31g4jEMpIXo6OjqKio0B9nZItVy4zwtsO/YE3bivF6vXqbk7PC5/NNadfv90/bJrPkysECwyKKomDHjh3o6OiAoiiora2ddpA+9dRT2Lx5MxRFQUdHB5qbmxd0LiMQCKCxsVG/bkFBAQKBAFRVxa5du+B0OqEoCnp7ezEyMhIx+Pfv34/k5GQoioKSkpJ594GIzDGSF2fPnsXu3bvR2NgIRVHQ1NSEHTt2zHouIhgMorq6GqWlpVAUBYqioLS0FNXV1RFFRmtrK/Ly8qAoCjIzMyOyQlEUnDt3DidOnNAf7/f74fP50N3drbfZ0NAAVVUBMEuuFCwwLHLw4EFs2bIFbrcbAOB2u7Fly5Ypj5v8mMLCQhw8eHBB1x4dHcXo6CgA4I477oDb7cbQ0BCGh4dRXl4OAJAkCRs2bMDJkyf152VlZWHjxo0LujYRmWc0L6qqqvSvKs/MzEROTg4GBgZmbLenpwculwuFhYX6bYWFhXC5XPjwww/124qKipCZmQkAOHXqFMbHx/WsAIDy8nKsWrUKwETR4vP5IvqSnZ2N8fFxvcBgllwZ+HXtFlBVFSMjI8jLy5vzsS6XK+LfGRkZEW/6ZrndbtTV1aGyshIAsH37dn0GMTg4iIKCgojHFxUV6aHgcrkgSdK8r01E5hnNi9TUVCxbtkz/tyRJcDqdc7bvdDqnHdfDw8OQZXnKY0ZHR5GSkjJnFmgZo0lPT8fY2BgAZsmVggWGhcIHMABDhcPJkyeRkZGxoOtq+6iBQAAej0cvYrKystDY2KjPOogofpjNC6OFycjICFRVnfKGP3lyM7kv4c8ZGxuL2FIBgKampoj+arTVU0p83CKxgLb94PP5Ig4+tba2Tnns7t27Ix7T1dWF7OzsWdt2uVz6NoqqqhF7tdqeKTAxo8jJyQEArF69GsDEkqnG7/fz73AQWcxoXpw9exYtLS36imNXVxeGh4f1sT2djRs3Ynh4GF1dXfpt2n9rWyKTTc4KVVXR0tKiFw4OhwO5ubnw+Xx6XwKBAPbu3Wv6tZO9scCwSElJCXJzc1FQUKCfwt66deuUx5WXl6O6uhqyLKOyshJ1dXX6Pux0JEnC5s2b0dXVBVmWUVZWhjvvvFO/PzMzEz6fD7IsIz8/H06nE7Isw+FwoLGxUb9Pm3lMNwMhotgykhepqam4//77UVZWBlmW0dzcjNra2llXJKcb9319fdi2bduMWxgOhwO1tbVobm7Wc+T+++/Xz2AAgMfjgdPpRH5+PmRZRktLCx5++GExPwyyjaRQKBQS0ZD2RsQZL1FsJMqYS5TXQWQXsRpzXMEgIiIi4XjI06a8Xu+UPdj09HR4vd5Zt1CI6Mqi/a2LwcHBiNuLiopm3QohWigWGDbl8Xjg8Xis7gYRxTmHw4G2tjaru0FXIG6REBERkXAsMIiIiEg4FhhEREQkHAsMIiIiEo4FBhEREQnHAoOIiIiEY4FBREREwrHAICIiIuFYYBAREa/2mwMAAADoSURBVJFwLDCIiIhIOBYYREREJBwLDCIiIhKOBQYREREJxwKDiIiIhBP+de2yLItukoiuAMwOosQibAUjJydHVFNEZFAijLtEeA1EdhOLcZcUCoVCUb8KERERXVF4BoOIiIiEY4FBREREwrHAICIiIuFYYBAREZFwLDCIiIhIOBYYREREJBwLDCIiIhKOBQYREREJxwKDiIiIhGOBQURERMKxwCAiIiLhWGAQERGRcCwwiIiISDgWGERERCQcCwwiIiISjgUGERERCccCg4iIiIRjgUFERETCscAgIiIi4VhgEBERkXD/BxdZdVoqk6yCAAAAAElFTkSuQmCC"> <ul><li><p>服务器：容器名<code>server-user</code>，端口<code>3301</code></p></li> <li><p>服务器：容器名<code>server-order</code>，端口<code>3302</code></p></li></ul> <h4 id="_1-1、创建server-user容器"><a href="#_1-1、创建server-user容器" class="header-anchor">#</a> 1.1、创建server-user容器</h4> <ul><li><strong>step1：创建容器：</strong></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -d <span class="token punctuation">\</span>
-p <span class="token number">3301</span>:3306 <span class="token punctuation">\</span>
-v /atguigu/server/user/conf:/etc/mysql/conf.d <span class="token punctuation">\</span>
-v /atguigu/server/user/data:/var/lib/mysql <span class="token punctuation">\</span>
-e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token punctuation">\</span>
--name server-user <span class="token punctuation">\</span>
mysql:8.0.29
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><strong>step2：登录MySQL服务器：</strong></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#进入容器：</span>
docker <span class="token builtin class-name">exec</span> -it server-user <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token comment">#进入容器内的mysql命令行</span>
mysql -uroot -p
<span class="token comment">#修改默认密码插件</span>
ALTER <span class="token environment constant">USER</span> <span class="token string">'root'</span>@<span class="token string">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><strong>step3：创建数据库：</strong></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> db_user<span class="token punctuation">;</span>
<span class="token keyword">USE</span> db_user<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_user <span class="token punctuation">(</span>
 id <span class="token keyword">BIGINT</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
 uname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_1-2、创建server-order容器"><a href="#_1-2、创建server-order容器" class="header-anchor">#</a> 1.2、创建server-order容器</h4> <ul><li><strong>step1：创建容器：</strong></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -d <span class="token punctuation">\</span>
-p <span class="token number">3302</span>:3306 <span class="token punctuation">\</span>
-v /atguigu/server/order/conf:/etc/mysql/conf.d <span class="token punctuation">\</span>
-v /atguigu/server/order/data:/var/lib/mysql <span class="token punctuation">\</span>
-e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token punctuation">\</span>
--name server-order <span class="token punctuation">\</span>
mysql:8.0.29
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><strong>step2：登录MySQL服务器：</strong></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#进入容器：</span>
docker <span class="token builtin class-name">exec</span> -it server-order <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token comment">#进入容器内的mysql命令行</span>
mysql -uroot -p
<span class="token comment">#修改默认密码插件</span>
ALTER <span class="token environment constant">USER</span> <span class="token string">'root'</span>@<span class="token string">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><strong>step3：创建数据库：</strong></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> db_order<span class="token punctuation">;</span>
<span class="token keyword">USE</span> db_order<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_order <span class="token punctuation">(</span>
  id <span class="token keyword">BIGINT</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  order_no <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  user_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_2、程序实现"><a href="#_2、程序实现" class="header-anchor">#</a> 2、程序实现</h3> <h4 id="_2-1、创建实体类"><a href="#_2-1、创建实体类" class="header-anchor">#</a> 2.1、创建实体类</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;t_order&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderNo<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> amount<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_2-2、创建mapper"><a href="#_2-2、创建mapper" class="header-anchor">#</a> 2.2、创建Mapper</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_2-3、配置垂直分片"><a href="#_2-3、配置垂直分片" class="header-anchor">#</a> 2.3、配置垂直分片</h4> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># 应用名称</span>
<span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">sharding-jdbc-demo</span>
<span class="token comment"># 环境设置</span>
<span class="token attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token attr-value">dev</span>

<span class="token comment"># 配置真实数据源</span>
<span class="token attr-name">spring.shardingsphere.datasource.names</span><span class="token punctuation">=</span><span class="token attr-value">server-user,server-order</span>

<span class="token comment"># 配置第 1 个数据源</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-user.type</span><span class="token punctuation">=</span><span class="token attr-value">com.zaxxer.hikari.HikariDataSource</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-user.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-user.jdbc-url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://192.168.100.201:3301/db_user</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-user.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-user.password</span><span class="token punctuation">=</span><span class="token attr-value">123456</span>

<span class="token comment"># 配置第 2 个数据源</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-order.type</span><span class="token punctuation">=</span><span class="token attr-value">com.zaxxer.hikari.HikariDataSource</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-order.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-order.jdbc-url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://192.168.100.201:3302/db_order</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-order.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-order.password</span><span class="token punctuation">=</span><span class="token attr-value">123456</span>

<span class="token comment"># 标准分片表配置（数据节点）</span>
<span class="token comment"># spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.actual-data-nodes=值</span>
<span class="token comment"># 值由数据源名 + 表名组成，以小数点分隔。</span>
<span class="token comment"># &lt;table-name&gt;：逻辑表名</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_user.actual-data-nodes</span><span class="token punctuation">=</span><span class="token attr-value">server-user.t_user</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_order.actual-data-nodes</span><span class="token punctuation">=</span><span class="token attr-value">server-order.t_order</span>


<span class="token comment"># 打印SQL</span>
<span class="token attr-name">spring.shardingsphere.props.sql-show</span><span class="token punctuation">=</span><span class="token attr-value">true</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="_3、测试垂直分片"><a href="#_3、测试垂直分片" class="header-anchor">#</a> 3、测试垂直分片</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShardingTest</span> <span class="token punctuation">{</span>


    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderMapper</span> orderMapper<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 垂直分片：插入数据测试
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsertOrderAndUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setUname</span><span class="token punctuation">(</span><span class="token string">&quot;强哥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 垂直分片：查询数据测试
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectFromOrderAndUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Order</span> order <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h4 id="常见错误"><a href="#常见错误" class="header-anchor">#</a> 常见错误</h4> <img src="/assets/img/image-20220810163534068.9e858df4.png"> <p>ShardingSphere-JDBC远程连接的方式默认的密码加密规则是：mysql_native_password</p> <p>因此需要在服务器端修改服务器的密码加密规则，如下：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">'root'</span><span class="token variable">@'%'</span> IDENTIFIED <span class="token keyword">WITH</span> mysql_native_password <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="第06章-shardingsphere-jdbc水平分片"><a href="#第06章-shardingsphere-jdbc水平分片" class="header-anchor">#</a> 第06章 ShardingSphere-JDBC水平分片</h2> <h3 id="_1、准备服务器-2"><a href="#_1、准备服务器-2" class="header-anchor">#</a> 1、准备服务器</h3> <p>服务器规划：使用<code>docker</code>方式创建如下容器</p> <img src="data:image/png;base64,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"> <ul><li><p>服务器：容器名<code>server-order0</code>，端口<code>3310</code></p></li> <li><p>服务器：容器名<code>server-order1</code>，端口<code>3311</code></p></li></ul> <h4 id="_1-1、创建server-order0容器"><a href="#_1-1、创建server-order0容器" class="header-anchor">#</a> 1.1、创建server-order0容器</h4> <ul><li><strong>step1：创建容器：</strong></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -d <span class="token punctuation">\</span>
-p <span class="token number">3310</span>:3306 <span class="token punctuation">\</span>
-v /atguigu/server/order0/conf:/etc/mysql/conf.d <span class="token punctuation">\</span>
-v /atguigu/server/order0/data:/var/lib/mysql <span class="token punctuation">\</span>
-e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token punctuation">\</span>
--name server-order0 <span class="token punctuation">\</span>
mysql:8.0.29
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><strong>step2：登录MySQL服务器：</strong></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#进入容器：</span>
docker <span class="token builtin class-name">exec</span> -it server-order0 <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token comment">#进入容器内的mysql命令行</span>
mysql -uroot -p
<span class="token comment">#修改默认密码插件</span>
ALTER <span class="token environment constant">USER</span> <span class="token string">'root'</span>@<span class="token string">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><strong>step3：创建数据库：</strong></li></ul> <p><code>注意：</code>水平分片的id需要在业务层实现，<code>不能依赖数据库的主键自增</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> db_order<span class="token punctuation">;</span>
<span class="token keyword">USE</span> db_order<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_order0 <span class="token punctuation">(</span>
  id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  order_no <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  user_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_order1 <span class="token punctuation">(</span>
  id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  order_no <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  user_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="_1-2、创建server-order1容器"><a href="#_1-2、创建server-order1容器" class="header-anchor">#</a> 1.2、创建server-order1容器</h4> <ul><li><strong>step1：创建容器：</strong></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -d <span class="token punctuation">\</span>
-p <span class="token number">3311</span>:3306 <span class="token punctuation">\</span>
-v /atguigu/server/order1/conf:/etc/mysql/conf.d <span class="token punctuation">\</span>
-v /atguigu/server/order1/data:/var/lib/mysql <span class="token punctuation">\</span>
-e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token punctuation">\</span>
--name server-order1 <span class="token punctuation">\</span>
mysql:8.0.29
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><strong>step2：登录MySQL服务器：</strong></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#进入容器：</span>
docker <span class="token builtin class-name">exec</span> -it server-order1 <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token comment">#进入容器内的mysql命令行</span>
mysql -uroot -p
<span class="token comment">#修改默认密码插件</span>
ALTER <span class="token environment constant">USER</span> <span class="token string">'root'</span>@<span class="token string">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>**step3：创建数据库：**和server-order0相同</li></ul> <p><code>注意：</code>水平分片的id需要在业务层实现，不能依赖数据库的主键自增</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> db_order<span class="token punctuation">;</span>
<span class="token keyword">USE</span> db_order<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_order0 <span class="token punctuation">(</span>
  id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  order_no <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  user_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_order1 <span class="token punctuation">(</span>
  id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  order_no <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  user_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_2、基本水平分片"><a href="#_2、基本水平分片" class="header-anchor">#</a> 2、基本水平分片</h3> <h4 id="_2-1、基本配置"><a href="#_2-1、基本配置" class="header-anchor">#</a> 2.1、基本配置</h4> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#========================基本配置</span>
<span class="token comment"># 应用名称</span>
<span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">sharging-jdbc-demo</span>
<span class="token comment"># 开发环境设置</span>
<span class="token attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token attr-value">dev</span>
<span class="token comment"># 内存模式</span>
<span class="token attr-name">spring.shardingsphere.mode.type</span><span class="token punctuation">=</span><span class="token attr-value">Memory</span>
<span class="token comment"># 打印SQl</span>
<span class="token attr-name">spring.shardingsphere.props.sql-show</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_2-2、数据源配置"><a href="#_2-2、数据源配置" class="header-anchor">#</a> 2.2、数据源配置</h4> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#========================数据源配置</span>
<span class="token comment"># 配置真实数据源</span>
<span class="token attr-name">spring.shardingsphere.datasource.names</span><span class="token punctuation">=</span><span class="token attr-value">server-user,server-order0,server-order1</span>

<span class="token comment"># 配置第 1 个数据源</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-user.type</span><span class="token punctuation">=</span><span class="token attr-value">com.zaxxer.hikari.HikariDataSource</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-user.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-user.jdbc-url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://192.168.100.201:3301/db_user</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-user.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-user.password</span><span class="token punctuation">=</span><span class="token attr-value">123456</span>

<span class="token comment"># 配置第 2 个数据源</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-order.type</span><span class="token punctuation">=</span><span class="token attr-value">com.zaxxer.hikari.HikariDataSource</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-order.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-order.jdbc-url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://192.168.100.201:3310/db_order</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-order.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-order.password</span><span class="token punctuation">=</span><span class="token attr-value">123456</span>

<span class="token comment"># 配置第 3 个数据源</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-order.type</span><span class="token punctuation">=</span><span class="token attr-value">com.zaxxer.hikari.HikariDataSource</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-order.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-order.jdbc-url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://192.168.100.201:3311/db_order</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-order.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name">spring.shardingsphere.datasource.server-order.password</span><span class="token punctuation">=</span><span class="token attr-value">123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="_2-3、标椎分片表配置"><a href="#_2-3、标椎分片表配置" class="header-anchor">#</a> 2.3、标椎分片表配置</h4> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#========================标准分片表配置（数据节点配置）</span>
<span class="token comment"># spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.actual-data-nodes=值</span>
<span class="token comment"># 值由数据源名 + 表名组成，以小数点分隔。多个表以逗号分隔，支持 inline 表达式。</span>
<span class="token comment"># &lt;table-name&gt;：逻辑表名</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_user.actual-data-nodes</span><span class="token punctuation">=</span><span class="token attr-value">server-user.t_user</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_order.actual-data-nodes</span><span class="token punctuation">=</span><span class="token attr-value">server-order0.t_order0,server-order0.t_order1,server-order1.t_order0,server-order1.t_order1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>修改Order实体类的主键策略：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//@TableId(type = IdType.AUTO)//依赖数据库的主键自增策略</span>
<span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>ASSIGN_ID<span class="token punctuation">)</span><span class="token comment">//分布式id</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>测试：保留上面配置中的一个分片表节点分别进行测试，检查每个分片节点是否可用</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
     * 水平分片：插入数据测试
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsertOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_2-4、行表达式"><a href="#_2-4、行表达式" class="header-anchor">#</a> 2.4、行表达式</h4> <p>优化上一步的分片表配置</p> <p>https://shardingsphere.apache.org/document/5.1.1/cn/features/sharding/concept/inline-expression/</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#========================标准分片表配置（数据节点配置）</span>
<span class="token comment"># spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.actual-data-nodes=值</span>
<span class="token comment"># 值由数据源名 + 表名组成，以小数点分隔。多个表以逗号分隔，支持 inline 表达式。</span>
<span class="token comment"># &lt;table-name&gt;：逻辑表名</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_user.actual-data-nodes</span><span class="token punctuation">=</span><span class="token attr-value">server-user.t_user</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_order.actual-data-nodes</span><span class="token punctuation">=</span><span class="token attr-value">server-order$-&gt;{0..1}.t_order$-&gt;{0..1}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_2-5、分片算法配置"><a href="#_2-5、分片算法配置" class="header-anchor">#</a> 2.5、分片算法配置</h4> <p><strong>水平分库：</strong></p> <p>分片规则：order表中<code>user_id</code>为偶数时，数据插入<code>server-order0服务器</code>，<code>user_id</code>为奇数时，数据插入<code>server-order1服务器</code>。这样分片的好处是，同一个用户的订单数据，一定会被插入到同一台服务器上，查询一个用户的订单时效率较高。</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#------------------------分库策略</span>
<span class="token comment"># 分片列名称</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_order.database-strategy.standard.sharding-column</span><span class="token punctuation">=</span><span class="token attr-value">user_id</span>
<span class="token comment"># 分片算法名称</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_order.database-strategy.standard.sharding-algorithm-name</span><span class="token punctuation">=</span><span class="token attr-value">alg_inline_userid</span>

<span class="token comment">#------------------------分片算法配置</span>
<span class="token comment"># 行表达式分片算法</span>
<span class="token comment"># 分片算法类型</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_inline_userid.type</span><span class="token punctuation">=</span><span class="token attr-value">INLINE</span>
<span class="token comment"># 分片算法属性配置</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_inline_userid.props.algorithm-expression</span><span class="token punctuation">=</span><span class="token attr-value">server-order$-&gt;{user_id % 2}</span>

<span class="token comment"># 取模分片算法</span>
<span class="token comment"># 分片算法类型</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_mod.type</span><span class="token punctuation">=</span><span class="token attr-value">MOD</span>
<span class="token comment"># 分片算法属性配置</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_mod.props.sharding-count</span><span class="token punctuation">=</span><span class="token attr-value">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>为了方便测试，先设置只在 <code>t_order0</code>表上进行测试</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">xxx.actual-data-nodes</span><span class="token punctuation">=</span><span class="token attr-value">server-order$-&gt;{0..1}.t_order0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>测试：可以分别测试行表达式分片算法和取模分片算法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
     * 水平分片：分库插入数据测试
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsertOrderDatabaseStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>水平分表：</strong></p> <p>分片规则：order表中<code>order_no的哈希值为偶数时</code>，数据插入对应服务器的<code>t_order0表</code>，<code>order_no的哈希值为奇数时</code>，数据插入对应服务器的<code>t_order1表</code>。因为order_no是字符串形式，因此不能直接取模。</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#------------------------分表策略</span>
<span class="token comment"># 分片列名称</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_order.table-strategy.standard.sharding-column</span><span class="token punctuation">=</span><span class="token attr-value">order_no</span>
<span class="token comment"># 分片算法名称</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_order.table-strategy.standard.sharding-algorithm-name</span><span class="token punctuation">=</span><span class="token attr-value">alg_hash_mod</span>


<span class="token comment">#------------------------分片算法配置</span>
<span class="token comment"># 哈希取模分片算法</span>
<span class="token comment"># 分片算法类型</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_hash_mod.type</span><span class="token punctuation">=</span><span class="token attr-value">HASH_MOD</span>
<span class="token comment"># 分片算法属性配置</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_hash_mod.props.sharding-count</span><span class="token punctuation">=</span><span class="token attr-value">2</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>测试前不要忘记将如下节点改回原来的状态</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">xxx.actual-data-nodes</span><span class="token punctuation">=</span><span class="token attr-value">server-order$-&gt;{0..1}.t_order$-&gt;{0..1}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>测试：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
     * 水平分片：分表插入数据测试
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsertOrderTableStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
     * 测试哈希取模
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token comment">//注意hash取模的结果是整个字符串hash后再取模，和数值后缀是奇数还是偶数无关</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU001&quot;</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU0011&quot;</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p><strong>查询测试：</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
     * 水平分片：查询所有记录
     * 查询了两个数据源，每个数据源中使用UNION ALL连接两个表
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testShardingSelectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> orders <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orders<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
     * 水平分片：根据user_id查询记录
     * 查询了一个数据源，每个数据源中使用UNION ALL连接两个表
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testShardingSelectByUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> orderQueryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderQueryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> orders <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>orderQueryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    orders<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="_2-6、分布式序列算法"><a href="#_2-6、分布式序列算法" class="header-anchor">#</a> 2.6、分布式序列算法</h4> <p><strong>雪花算法：</strong></p> <p>https://shardingsphere.apache.org/document/5.1.1/cn/features/sharding/concept/key-generator/</p> <p>水平分片需要关注全局序列，因为不能简单的使用基于数据库的主键自增。</p> <p>这里有两种方案：一种是基于MyBatisPlus的id策略；一种是ShardingSphere-JDBC的全局序列配置。</p> <p><code>基于MyBatisPlus的id策略：</code>将Order类的id设置成如下形式</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>ASSIGN_ID<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>基于ShardingSphere-JDBC的全局序列配置</code>：和前面的MyBatisPlus的策略二选一</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#------------------------分布式序列策略配置</span>
<span class="token comment"># 分布式序列列名称</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_order.key-generate-strategy.column</span><span class="token punctuation">=</span><span class="token attr-value">id</span>
<span class="token comment"># 分布式序列算法名称</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_order.key-generate-strategy.key-generator-name</span><span class="token punctuation">=</span><span class="token attr-value">alg_snowflake</span>

<span class="token comment"># 分布式序列算法配置</span>
<span class="token comment"># 分布式序列算法类型</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.key-generators.alg_snowflake.type</span><span class="token punctuation">=</span><span class="token attr-value">SNOWFLAKE</span>
<span class="token comment"># 分布式序列算法属性配置</span>
<span class="token comment">#spring.shardingsphere.rules.sharding.key-generators.alg_snowflake.props.xxx=</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>此时，需要将实体类中的id策略修改成以下形式：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//当配置了shardingsphere-jdbc的分布式序列时，自动使用shardingsphere-jdbc的分布式序列</span>
<span class="token comment">//当没有配置shardingsphere-jdbc的分布式序列时，自动依赖数据库的主键自增策略</span>
<span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3、多表关联"><a href="#_3、多表关联" class="header-anchor">#</a> 3、多表关联</h3> <h4 id="_3-1、创建关联表"><a href="#_3-1、创建关联表" class="header-anchor">#</a> 3.1、创建关联表</h4> <p>在<code>server-order0、server-order1</code>服务器中分别创建两张订单详情表<code>t_order_item0、t_order_item1</code></p> <p>我们希望<code>同一个用户的订单表和订单详情表中的数据都在同一个数据源中，避免跨库关联</code>，因此这两张表我们使用相同的分片策略。</p> <p>那么在<code>t_order_item</code>中我们也需要创建<code>order_no</code>和<code>user_id</code>这两个分片键</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_order_item0<span class="token punctuation">(</span>
    id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    order_no <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    user_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    price <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>count<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_order_item1<span class="token punctuation">(</span>
    id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    order_no <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    user_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    price <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>count<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_3-2、创建实体类"><a href="#_3-2、创建实体类" class="header-anchor">#</a> 3.2、创建实体类</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;t_order_item&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderItem</span> <span class="token punctuation">{</span>
    <span class="token comment">//当配置了shardingsphere-jdbc的分布式序列时，自动使用shardingsphere-jdbc的分布式序列</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderNo<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> price<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> count<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_3-3、创建mapper"><a href="#_3-3、创建mapper" class="header-anchor">#</a> 3.3、创建Mapper</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shargingjdbcdemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderItemMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItem</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_3-4、配置关联表"><a href="#_3-4、配置关联表" class="header-anchor">#</a> 3.4、配置关联表</h4> <p>t_order_item的分片表、分片策略、分布式序列策略和t_order一致</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#------------------------标准分片表配置（数据节点配置）</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_order_item.actual-data-nodes</span><span class="token punctuation">=</span><span class="token attr-value">server-order$-&gt;{0..1}.t_order_item$-&gt;{0..1}</span>

<span class="token comment">#------------------------分库策略</span>
<span class="token comment"># 分片列名称</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_order_item.database-strategy.standard.sharding-column</span><span class="token punctuation">=</span><span class="token attr-value">user_id</span>
<span class="token comment"># 分片算法名称</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_order_item.database-strategy.standard.sharding-algorithm-name</span><span class="token punctuation">=</span><span class="token attr-value">alg_mod</span>

<span class="token comment">#------------------------分表策略</span>
<span class="token comment"># 分片列名称</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_order_item.table-strategy.standard.sharding-column</span><span class="token punctuation">=</span><span class="token attr-value">order_no</span>
<span class="token comment"># 分片算法名称</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_order_item.table-strategy.standard.sharding-algorithm-name</span><span class="token punctuation">=</span><span class="token attr-value">alg_hash_mod</span>

<span class="token comment">#------------------------分布式序列策略配置</span>
<span class="token comment"># 分布式序列列名称</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_order_item.key-generate-strategy.column</span><span class="token punctuation">=</span><span class="token attr-value">id</span>
<span class="token comment"># 分布式序列算法名称</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_order_item.key-generate-strategy.key-generator-name</span><span class="token punctuation">=</span><span class="token attr-value">alg_snowflake</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_3-5、测试插入数据"><a href="#_3-5、测试插入数据" class="header-anchor">#</a> 3.5、测试插入数据</h4> <p>同一个用户的订单表和订单详情表中的数据都在同一个数据源中，避免跨库关联</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
     * 测试关联表插入
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsertOrderAndOrderItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">OrderItem</span> orderItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItemMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>orderItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">OrderItem</span> orderItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItemMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>orderItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h3 id="_4、绑定表"><a href="#_4、绑定表" class="header-anchor">#</a> 4、绑定表</h3> <p>**需求：**查询每个订单的订单号和总订单金额</p> <h4 id="_4-1、创建vo对象"><a href="#_4-1、创建vo对象" class="header-anchor">#</a> 4.1、创建VO对象</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderVo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderNo<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> amount<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_4-2、添加mapper方法"><a href="#_4-2、添加mapper方法" class="header-anchor">#</a> 4.2、添加Mapper方法</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;SELECT o.order_no, SUM(i.price * i.count) AS amount&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;FROM t_order o JOIN t_order_item i ON o.order_no = i.order_no&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;GROUP BY o.order_no&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getOrderAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_4-3、测试关联查询"><a href="#_4-3、测试关联查询" class="header-anchor">#</a> 4.3、测试关联查询</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
     * 测试关联表查询
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetOrderAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderVo</span><span class="token punctuation">&gt;</span></span> orderAmountList <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">getOrderAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderAmountList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_4-4、配置绑定表"><a href="#_4-4、配置绑定表" class="header-anchor">#</a> 4.4、配置绑定表</h4> <p>在原来水平分片配置的基础上添加如下配置：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#------------------------绑定表</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.binding-tables[0]</span><span class="token punctuation">=</span><span class="token attr-value">t_order,t_order_item</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>配置完绑定表后再次进行关联查询的测试：</p> <ul><li><p>**如果不配置绑定表：测试的结果为8个SQL。**多表关联查询会出现笛卡尔积关联。</p></li> <li><p><strong>如果配置绑定表：测试的结果为4个SQL。</strong> 多表关联查询不会出现笛卡尔积关联，关联查询效率将大大提升。</p></li></ul> <p><code>绑定表：</code>指分片规则一致的一组分片表。 使用绑定表进行多表关联查询时，必须使用分片键进行关联，否则会出现笛卡尔积关联或跨库关联，从而影响查询效率。</p> <h3 id="_5、广播表"><a href="#_5、广播表" class="header-anchor">#</a> 5、广播表</h3> <h4 id="_4-1、什么是广播表"><a href="#_4-1、什么是广播表" class="header-anchor">#</a> 4.1、什么是广播表</h4> <p>指所有的分片数据源中都存在的表，表结构及其数据在每个数据库中均完全一致。 适用于数据量不大且需要与海量数据的表进行关联查询的场景，例如：字典表。</p> <p>广播具有以下特性：</p> <p>（1）插入、更新操作会实时在所有节点上执行，保持各个分片的数据一致性</p> <p>（2）查询操作，只从一个节点获取</p> <p>（3）可以跟任何一个表进行 JOIN 操作</p> <h4 id="_4-2、创建广播表"><a href="#_4-2、创建广播表" class="header-anchor">#</a> 4.2、创建广播表</h4> <p>在server-order0、server-order1和server-user服务器中分别创建t_dict表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_dict<span class="token punctuation">(</span>
    id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    dict_type <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_4-3、程序实现"><a href="#_4-3、程序实现" class="header-anchor">#</a> 4.3、程序实现</h4> <h5 id="_4-3-1、创建实体类"><a href="#_4-3-1、创建实体类" class="header-anchor">#</a> 4.3.1、创建实体类</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;t_dict&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dict</span> <span class="token punctuation">{</span>
    <span class="token comment">//可以使用MyBatisPlus的雪花算法</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>ASSIGN_ID<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> dictType<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="_4-3-2、创建mapper"><a href="#_4-3-2、创建mapper" class="header-anchor">#</a> 4.3.2、创建Mapper</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DictMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dict</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="_4-3-3、配置广播表"><a href="#_4-3-3、配置广播表" class="header-anchor">#</a> 4.3.3、配置广播表</h5> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#数据节点可不配置，默认情况下，向所有数据源广播</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.tables.t_dict.actual-data-nodes</span><span class="token punctuation">=</span><span class="token attr-value">server-user.t_dict,server-order$-&gt;{0..1}.t_dict</span>

<span class="token comment"># 广播表</span>
<span class="token attr-name">spring.shardingsphere.rules.sharding.broadcast-tables[0]</span><span class="token punctuation">=</span><span class="token attr-value">t_dict</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_4-4、测试广播表"><a href="#_4-4、测试广播表" class="header-anchor">#</a> 4.4、测试广播表</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">DictMapper</span> dictMapper<span class="token punctuation">;</span>

<span class="token comment">/**
     * 广播表：每个服务器中的t_dict同时添加了新数据
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testBroadcast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token class-name">Dict</span> dict <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dict<span class="token punctuation">.</span><span class="token function">setDictType</span><span class="token punctuation">(</span><span class="token string">&quot;type1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dictMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>dict<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
     * 查询操作，只从一个节点获取数据
     * 随机负载均衡规则
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectBroadcast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dict</span><span class="token punctuation">&gt;</span></span> dicts <span class="token operator">=</span> dictMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dicts<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="第07章-启动shardingsphere-proxy"><a href="#第07章-启动shardingsphere-proxy" class="header-anchor">#</a> 第07章 启动ShardingSphere-Proxy</h2> <h3 id="_1、获取"><a href="#_1、获取" class="header-anchor">#</a> 1、获取</h3> <p>目前 ShardingSphere-Proxy 提供了 3 种获取方式：</p> <ul><li><a href="https://shardingsphere.apache.org/document/5.1.1/cn/user-manual/shardingsphere-proxy/startup/bin/" target="_blank" rel="noopener noreferrer">二进制发布包<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://shardingsphere.apache.org/document/5.1.1/cn/user-manual/shardingsphere-proxy/startup/docker/" target="_blank" rel="noopener noreferrer">Docker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://shardingsphere.apache.org/document/5.1.1/cn/user-manual/shardingsphere-proxy/startup/helm/" target="_blank" rel="noopener noreferrer">Helm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="_2、使用二进制发布包安装"><a href="#_2、使用二进制发布包安装" class="header-anchor">#</a> 2、使用二进制发布包安装</h3> <p>二进制包既可以Linux系统运行，又可以在windows系统运行</p> <p><strong>step1：解压二进制包</strong></p> <p><code>apache-shardingsphere-5.1.1-shardingsphere-proxy-bin.tar.gz</code></p> <p>windows：使用解压软件解压文件</p> <p>Linux：将文件上传至/opt目录，并解压</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">tar</span> -zxvf apache-shardingsphere-5.1.1-shardingsphere-proxy-bin.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>step2：MySQL驱动</strong></p> <p><code>mysql-connector-java-8.0.22.jar</code></p> <p>将MySQl驱动放至解压目录中的<code>ext-lib</code>目录</p> <p><strong>spte3：修改配置conf/server.yaml</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token tag">!AUTHORITY</span>
    <span class="token key atrule">users</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> root@%<span class="token punctuation">:</span>root
    <span class="token key atrule">provider</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> ALL_PRIVILEGES_PERMITTED

<span class="token key atrule">props</span><span class="token punctuation">:</span>
  <span class="token key atrule">sql-show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>spte4：启动ShardingSphere-Proxy</strong></p> <p>Linux 操作系统请运行 <code>bin/start.sh</code></p> <p>Windows 操作系统请运行 <code>bin/start.bat</code></p> <p>指定端口号和配置文件目录：<code>bin/start.bat ${proxy_port} ${proxy_conf_directory}</code></p> <p><strong>step5：远程连接ShardingSphere-Proxy</strong></p> <p>远程访问</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysql -h192.168.100.1 -P3307 -uroot -p
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>step6：访问测试</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><img src="data:image/png;base64,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"> <h3 id="_3、使用docker安装"><a href="#_3、使用docker安装" class="header-anchor">#</a> 3、使用Docker安装</h3> <p><strong>step1：启动Docker容器</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -d <span class="token punctuation">\</span>
-v /atguigu/server/proxy-a/conf:/opt/shardingsphere-proxy/conf <span class="token punctuation">\</span>
-v /atguigu/server/proxy-a/ext-lib:/opt/shardingsphere-proxy/ext-lib <span class="token punctuation">\</span>
-e <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Xmx256m -Xms256m -Xmn128m&quot;</span> <span class="token punctuation">\</span>
-p <span class="token number">3321</span>:3307 <span class="token punctuation">\</span>
--name server-proxy-a <span class="token punctuation">\</span>
apache/shardingsphere-proxy:5.1.1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>step2：上传MySQL驱动</strong></p> <p>将MySQl驱动上传至<code>/atguigu/server/proxy-a/ext-lib</code>目录</p> <p><strong>spte3：修改配置server.yaml</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token tag">!AUTHORITY</span>
    <span class="token key atrule">users</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> root@%<span class="token punctuation">:</span>root
    <span class="token key atrule">provider</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> ALL_PRIVILEGES_PERMITTED

<span class="token key atrule">props</span><span class="token punctuation">:</span>
  <span class="token key atrule">sql-show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>将配置文件上传至<code>/atguigu/server/proxy-a/conf</code>目录</p> <p><strong>spte4：重启容器</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker restart server-proxy-a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>step5：远程连接ShardingSphere-Proxy</strong></p> <p>ShardingSphere-Proxy容器中默认情况下没有mysql命令行客户端的安装，因此需要远程访问</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysql -h192.168.100.201 -P3321 -uroot -p
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>step6：访问测试</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><img src="data:image/png;base64,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"> <p><strong>常见问题：docker容器无法远程连接</strong></p> <p>容器可以成功的创建并启动，但是无法远程连接。排除防火墙和网络等问题后，看看是不是因为容器内存不足导致。</p> <p><code>原因：</code>容器可分配内存不足</p> <p><code>查看办法：</code>进入容器后查看ShardingSphere-Proxy的日志，如有有<code>cannot allocate memory</code>，则说明容器内存不足</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker <span class="token builtin class-name">exec</span> -it server-proxy-a <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token builtin class-name">cd</span> /opt/shardingsphere-proxy/logs
<span class="token function">tail</span> stdout.log 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><img src="/assets/img/image-20220819151154763.d36943da.png"> <p><code>解决方案：</code>创建容器的时候使用JVM参数</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>-e <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Xmx256m -Xms256m -Xmn128m&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="第08章-shardingsphere-proxy读写分离"><a href="#第08章-shardingsphere-proxy读写分离" class="header-anchor">#</a> 第08章 ShardingSphere-Proxy读写分离</h2> <h3 id="_1、修改配置文件"><a href="#_1、修改配置文件" class="header-anchor">#</a> 1、修改配置文件</h3> <p><strong>修改配置config-readwrite-splitting.yaml</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">schemaName</span><span class="token punctuation">:</span> readwrite_splitting_db

<span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
  <span class="token key atrule">write_ds</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.100.201<span class="token punctuation">:</span>3306/db_user<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">read_ds_0</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.100.201<span class="token punctuation">:</span>3307/db_user<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">read_ds_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.100.201<span class="token punctuation">:</span>3308/db_user<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token tag">!READWRITE_SPLITTING</span>
  <span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
    <span class="token key atrule">readwrite_ds</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> Static
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">write-data-source-name</span><span class="token punctuation">:</span> write_ds
        <span class="token key atrule">read-data-source-names</span><span class="token punctuation">:</span> read_ds_0<span class="token punctuation">,</span>read_ds_1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>将配置文件上传至<code>/atguigu/server/proxy-a/conf</code>目录</p> <p><strong>重启容器</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker restart server-proxy-a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2、实时查看日志"><a href="#_2、实时查看日志" class="header-anchor">#</a> 2、实时查看日志</h3> <p>可以通过这种方式查看服务器中输出的SQL语句</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker <span class="token builtin class-name">exec</span> -it server-proxy-a <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token function">tail</span> -f /opt/shardingsphere-proxy/logs/stdout.log 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3、远程访问测试"><a href="#_3、远程访问测试" class="header-anchor">#</a> 3、远程访问测试</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">use</span> readwrite_splitting_db<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_user<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_user<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> t_user<span class="token punctuation">(</span>uname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'wang5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_4、应用程序访问proxy"><a href="#_4、应用程序访问proxy" class="header-anchor">#</a> 4、应用程序访问Proxy</h3> <h4 id="_4-1、创建项目"><a href="#_4-1、创建项目" class="header-anchor">#</a> 4.1、创建项目</h4> <p>项目类型：Spring Initializr</p> <p>SpringBoot脚手架：http://start.aliyun.com</p> <p>项目名：sharding-proxy-demo</p> <p>SpringBoot版本：2.3.7.RELEASE</p> <h4 id="_4-2、添加依赖"><a href="#_4-2、添加依赖" class="header-anchor">#</a> 4.2、添加依赖</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h4 id="_4-3、创建实体类"><a href="#_4-3、创建实体类" class="header-anchor">#</a> 4.3、创建实体类</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingproxydemo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;t_user&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> uname<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_4-4、创建mapper"><a href="#_4-4、创建mapper" class="header-anchor">#</a> 4.4、创建Mapper</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingproxydemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_4-5、配置数据源"><a href="#_4-5、配置数据源" class="header-anchor">#</a> 4.5、配置数据源</h4> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># 应用名称</span>
<span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">sharding-proxy-demo</span>
<span class="token comment"># 开发环境设置</span>
<span class="token attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token attr-value">dev</span>

<span class="token comment">#mysql数据库连接（proxy）</span>
<span class="token attr-name">spring.datasource.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span>
<span class="token attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://192.168.100.201:3321/readwrite_splitting_db?serverTimezone=GMT%2B8&amp;useSSL=false</span>
<span class="token attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token attr-value">root</span>

<span class="token comment">#mybatis日志</span>
<span class="token attr-name">mybatis-plus.configuration.log-impl</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.ibatis.logging.stdout.StdOutImpl</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_4-6、测试"><a href="#_4-6、测试" class="header-anchor">#</a> 4.6、测试</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingproxydemo</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">ShardingProxyDemoApplicationTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 读数据测试
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        users<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="第09章-shardingsphere-proxy垂直分片"><a href="#第09章-shardingsphere-proxy垂直分片" class="header-anchor">#</a> 第09章 ShardingSphere-Proxy垂直分片</h2> <h3 id="_1、修改配置文件-2"><a href="#_1、修改配置文件-2" class="header-anchor">#</a> 1、修改配置文件</h3> <p><strong>修改配置config-sharding.yaml</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">schemaName</span><span class="token punctuation">:</span> sharding_db

<span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
  <span class="token key atrule">ds_0</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.100.201<span class="token punctuation">:</span>3301/db_user<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">ds_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.100.201<span class="token punctuation">:</span>3302/db_order<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token tag">!SHARDING</span>
  <span class="token key atrule">tables</span><span class="token punctuation">:</span>
    <span class="token key atrule">t_user</span><span class="token punctuation">:</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> ds_0.t_user
    <span class="token key atrule">t_order</span><span class="token punctuation">:</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> ds_1.t_order
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="_2、实时查看日志-2"><a href="#_2、实时查看日志-2" class="header-anchor">#</a> 2、实时查看日志</h3> <p>可以通过这种方式查看服务器中输出的SQL语句</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker <span class="token builtin class-name">exec</span> -it server-proxy-a <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token function">tail</span> -f /opt/shardingsphere-proxy/logs/stdout.log 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3、远程访问测试-2"><a href="#_3、远程访问测试-2" class="header-anchor">#</a> 3、远程访问测试</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">use</span> sharding_db<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_order<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_user<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="第10章-shardingsphere-proxy水平分片"><a href="#第10章-shardingsphere-proxy水平分片" class="header-anchor">#</a> 第10章 ShardingSphere-Proxy水平分片</h2> <h3 id="_1、修改配置文件-3"><a href="#_1、修改配置文件-3" class="header-anchor">#</a> 1、修改配置文件</h3> <p><strong>修改配置config-sharding.yaml</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">schemaName</span><span class="token punctuation">:</span> sharding_db

<span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
  <span class="token key atrule">ds_user</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.100.201<span class="token punctuation">:</span>3301/db_user<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">ds_order0</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.100.201<span class="token punctuation">:</span>3310/db_order<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">ds_order1</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.100.201<span class="token punctuation">:</span>3311/db_order<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token tag">!SHARDING</span>
  <span class="token key atrule">tables</span><span class="token punctuation">:</span>
    <span class="token key atrule">t_user</span><span class="token punctuation">:</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> ds_user.t_user

    <span class="token key atrule">t_order</span><span class="token punctuation">:</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> ds_order$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>.t_order$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>
      <span class="token key atrule">databaseStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> user_id
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> alg_mod
      <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> order_no
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> alg_hash_mod
      <span class="token key atrule">keyGenerateStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">column</span><span class="token punctuation">:</span> id
        <span class="token key atrule">keyGeneratorName</span><span class="token punctuation">:</span> snowflake
    <span class="token key atrule">t_order_item</span><span class="token punctuation">:</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> ds_order$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>.t_order_item$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>
      <span class="token key atrule">databaseStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> user_id
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> alg_mod
      <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> order_no
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> alg_hash_mod
      <span class="token key atrule">keyGenerateStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">column</span><span class="token punctuation">:</span> id
        <span class="token key atrule">keyGeneratorName</span><span class="token punctuation">:</span> snowflake

  <span class="token key atrule">bindingTables</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> t_order<span class="token punctuation">,</span>t_order_item


  <span class="token key atrule">broadcastTables</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> t_dict

  <span class="token key atrule">shardingAlgorithms</span><span class="token punctuation">:</span>
    <span class="token key atrule">alg_inline_userid</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> INLINE
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> server<span class="token punctuation">-</span>order$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>user_id % 2<span class="token punctuation">}</span>
    <span class="token key atrule">alg_mod</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> MOD
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">sharding-count</span><span class="token punctuation">:</span> <span class="token number">2</span>
    <span class="token key atrule">alg_hash_mod</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> HASH_MOD
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">sharding-count</span><span class="token punctuation">:</span> <span class="token number">2</span>
  
  <span class="token key atrule">keyGenerators</span><span class="token punctuation">:</span>
    <span class="token key atrule">snowflake</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br></div></div><h3 id="_2、实时查看日志-3"><a href="#_2、实时查看日志-3" class="header-anchor">#</a> 2、实时查看日志</h3> <p>可以通过这种方式查看服务器中输出的SQL语句</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker <span class="token builtin class-name">exec</span> -it server-proxy-a <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token function">tail</span> -f /opt/shardingsphere-proxy/logs/stdout.log 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3、远程访问测试-3"><a href="#_3、远程访问测试-3" class="header-anchor">#</a> 3、远程访问测试</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">use</span> sharding_db<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_order<span class="token punctuation">;</span> <span class="token comment">--测试水平分片</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_dict<span class="token punctuation">;</span> <span class="token comment">--测试广播表</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/articles/devops/atguigu_docker.html" class="prev">
            尚硅谷_Docker的安装与卸载
          </a></span> <span class="next"><a href="/articles/devops/docker.html">
            Docker学习笔记
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#第01章-高性能架构模式" class="sidebar-link reco-side-第01章-高性能架构模式" data-v-70334359>第01章 高性能架构模式</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_1、读写分离架构" class="sidebar-link reco-side-_1、读写分离架构" data-v-70334359>1、读写分离架构</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_2、数据库分片架构" class="sidebar-link reco-side-_2、数据库分片架构" data-v-70334359>2、数据库分片架构</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_3、读写分离和数据分片架构" class="sidebar-link reco-side-_3、读写分离和数据分片架构" data-v-70334359>3、读写分离和数据分片架构</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_4、实现方式" class="sidebar-link reco-side-_4、实现方式" data-v-70334359>4、实现方式</a></li><li class="level-2" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#第02章-shardingsphere" class="sidebar-link reco-side-第02章-shardingsphere" data-v-70334359>第02章 ShardingSphere</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_1、简介" class="sidebar-link reco-side-_1、简介" data-v-70334359>1、简介</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_2、shardingsphere-jdbc" class="sidebar-link reco-side-_2、shardingsphere-jdbc" data-v-70334359>2、ShardingSphere-JDBC</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_3、shardingsphere-proxy" class="sidebar-link reco-side-_3、shardingsphere-proxy" data-v-70334359>3、ShardingSphere-Proxy</a></li><li class="level-2" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#第03章-mysql主从同步" class="sidebar-link reco-side-第03章-mysql主从同步" data-v-70334359>第03章 MySQL主从同步</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_1、mysql主从同步原理" class="sidebar-link reco-side-_1、mysql主从同步原理" data-v-70334359>1、MySQL主从同步原理</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_2、一主多从配置" class="sidebar-link reco-side-_2、一主多从配置" data-v-70334359>2、一主多从配置</a></li><li class="level-2" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#第04章-shardingsphere-jdbc读写分离" class="sidebar-link reco-side-第04章-shardingsphere-jdbc读写分离" data-v-70334359>第04章 ShardingSphere-JDBC读写分离</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_1、创建springboot程序" class="sidebar-link reco-side-_1、创建springboot程序" data-v-70334359>1、创建SpringBoot程序</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_2、测试" class="sidebar-link reco-side-_2、测试" data-v-70334359>2、测试</a></li><li class="level-2" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#第05章-shardingsphere-jdbc垂直分片" class="sidebar-link reco-side-第05章-shardingsphere-jdbc垂直分片" data-v-70334359>第05章 ShardingSphere-JDBC垂直分片</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_1、准备服务器" class="sidebar-link reco-side-_1、准备服务器" data-v-70334359>1、准备服务器</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_2、程序实现" class="sidebar-link reco-side-_2、程序实现" data-v-70334359>2、程序实现</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_3、测试垂直分片" class="sidebar-link reco-side-_3、测试垂直分片" data-v-70334359>3、测试垂直分片</a></li><li class="level-2" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#第06章-shardingsphere-jdbc水平分片" class="sidebar-link reco-side-第06章-shardingsphere-jdbc水平分片" data-v-70334359>第06章 ShardingSphere-JDBC水平分片</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_1、准备服务器-2" class="sidebar-link reco-side-_1、准备服务器-2" data-v-70334359>1、准备服务器</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_2、基本水平分片" class="sidebar-link reco-side-_2、基本水平分片" data-v-70334359>2、基本水平分片</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_3、多表关联" class="sidebar-link reco-side-_3、多表关联" data-v-70334359>3、多表关联</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_4、绑定表" class="sidebar-link reco-side-_4、绑定表" data-v-70334359>4、绑定表</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_5、广播表" class="sidebar-link reco-side-_5、广播表" data-v-70334359>5、广播表</a></li><li class="level-2" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#第07章-启动shardingsphere-proxy" class="sidebar-link reco-side-第07章-启动shardingsphere-proxy" data-v-70334359>第07章 启动ShardingSphere-Proxy</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_1、获取" class="sidebar-link reco-side-_1、获取" data-v-70334359>1、获取</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_2、使用二进制发布包安装" class="sidebar-link reco-side-_2、使用二进制发布包安装" data-v-70334359>2、使用二进制发布包安装</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_3、使用docker安装" class="sidebar-link reco-side-_3、使用docker安装" data-v-70334359>3、使用Docker安装</a></li><li class="level-2" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#第08章-shardingsphere-proxy读写分离" class="sidebar-link reco-side-第08章-shardingsphere-proxy读写分离" data-v-70334359>第08章 ShardingSphere-Proxy读写分离</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_1、修改配置文件" class="sidebar-link reco-side-_1、修改配置文件" data-v-70334359>1、修改配置文件</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_2、实时查看日志" class="sidebar-link reco-side-_2、实时查看日志" data-v-70334359>2、实时查看日志</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_3、远程访问测试" class="sidebar-link reco-side-_3、远程访问测试" data-v-70334359>3、远程访问测试</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_4、应用程序访问proxy" class="sidebar-link reco-side-_4、应用程序访问proxy" data-v-70334359>4、应用程序访问Proxy</a></li><li class="level-2" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#第09章-shardingsphere-proxy垂直分片" class="sidebar-link reco-side-第09章-shardingsphere-proxy垂直分片" data-v-70334359>第09章 ShardingSphere-Proxy垂直分片</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_1、修改配置文件-2" class="sidebar-link reco-side-_1、修改配置文件-2" data-v-70334359>1、修改配置文件</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_2、实时查看日志-2" class="sidebar-link reco-side-_2、实时查看日志-2" data-v-70334359>2、实时查看日志</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_3、远程访问测试-2" class="sidebar-link reco-side-_3、远程访问测试-2" data-v-70334359>3、远程访问测试</a></li><li class="level-2" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#第10章-shardingsphere-proxy水平分片" class="sidebar-link reco-side-第10章-shardingsphere-proxy水平分片" data-v-70334359>第10章 ShardingSphere-Proxy水平分片</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_1、修改配置文件-3" class="sidebar-link reco-side-_1、修改配置文件-3" data-v-70334359>1、修改配置文件</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_2、实时查看日志-3" class="sidebar-link reco-side-_2、实时查看日志-3" data-v-70334359>2、实时查看日志</a></li><li class="level-3" data-v-70334359><a href="/articles/devops/atguigu_ShardingSphere5.html#_3、远程访问测试-3" class="sidebar-link reco-side-_3、远程访问测试-3" data-v-70334359>3、远程访问测试</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.b0706364.js" defer></script><script src="/assets/js/4.e0c2274c.js" defer></script><script src="/assets/js/1.f767751f.js" defer></script><script src="/assets/js/5.0d1dda84.js" defer></script>
  </body>
</html>
